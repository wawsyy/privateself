{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/internal/constants.ts"],"sourcesContent":["export const SDK_CDN_URL =\r\n  \"https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs\";\r\n\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,cACX","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/internal/RelayerSDKLoader.ts"],"sourcesContent":["import { FhevmRelayerSDKType, FhevmWindowType } from \"./fhevmTypes\";\r\nimport { SDK_CDN_URL } from \"./constants\";\r\n\r\ntype TraceType = (message?: unknown, ...optionalParams: unknown[]) => void;\r\n\r\nexport class RelayerSDKLoader {\r\n  private _trace?: TraceType;\r\n\r\n  constructor(options: { trace?: TraceType }) {\r\n    this._trace = options.trace;\r\n  }\r\n\r\n  public isLoaded() {\r\n    if (typeof window === \"undefined\") {\r\n      throw new Error(\"RelayerSDKLoader: can only be used in the browser.\");\r\n    }\r\n    return isFhevmWindowType(window, this._trace);\r\n  }\r\n\r\n  public load(): Promise<void> {\r\n    console.log(\"[RelayerSDKLoader] load...\");\r\n    if (typeof window === \"undefined\") {\r\n      console.log(\"[RelayerSDKLoader] window === undefined\");\r\n      return Promise.reject(\r\n        new Error(\"RelayerSDKLoader: can only be used in the browser.\")\r\n      );\r\n    }\r\n\r\n    if (\"relayerSDK\" in window) {\r\n      if (!isFhevmRelayerSDKType(window.relayerSDK, this._trace)) {\r\n        console.log(\"[RelayerSDKLoader] window.relayerSDK === undefined\");\r\n        throw new Error(\"RelayerSDKLoader: Unable to load FHEVM Relayer SDK\");\r\n      }\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const existingScript = document.querySelector(\r\n        `script[src=\"${SDK_CDN_URL}\"]`\r\n      );\r\n      if (existingScript) {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          reject(\r\n            new Error(\r\n              \"RelayerSDKLoader: window object does not contain a valid relayerSDK object.\"\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = SDK_CDN_URL;\r\n      script.type = \"text/javascript\";\r\n      script.async = true;\r\n\r\n      script.onload = () => {\r\n        if (!isFhevmWindowType(window, this._trace)) {\r\n          console.log(\"[RelayerSDKLoader] script onload FAILED...\");\r\n          reject(\r\n            new Error(\r\n              `RelayerSDKLoader: Relayer SDK script has been successfully loaded from ${SDK_CDN_URL}, however, the window.relayerSDK object is invalid.`\r\n            )\r\n          );\r\n        }\r\n        resolve();\r\n      };\r\n\r\n      script.onerror = () => {\r\n        console.log(\"[RelayerSDKLoader] script onerror... \");\r\n        reject(\r\n          new Error(\r\n            `RelayerSDKLoader: Failed to load Relayer SDK from ${SDK_CDN_URL}`\r\n          )\r\n        );\r\n      };\r\n\r\n      console.log(\"[RelayerSDKLoader] add script to DOM...\");\r\n      document.head.appendChild(script);\r\n      console.log(\"[RelayerSDKLoader] script added!\")\r\n    });\r\n  }\r\n}\r\n\r\nfunction isFhevmRelayerSDKType(\r\n  o: unknown,\r\n  trace?: TraceType\r\n): o is FhevmRelayerSDKType {\r\n  if (typeof o === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is undefined\");\r\n    return false;\r\n  }\r\n  if (o === null) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is null\");\r\n    return false;\r\n  }\r\n  if (typeof o !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK is not an object\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"initSDK\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.initSDK is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"createInstance\", \"function\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.createInstance is invalid\");\r\n    return false;\r\n  }\r\n  if (!objHasProperty(o, \"SepoliaConfig\", \"object\", trace)) {\r\n    trace?.(\"RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid\");\r\n    return false;\r\n  }\r\n  if (\"__initialized__\" in o) {\r\n    if (o.__initialized__ !== true && o.__initialized__ !== false) {\r\n      trace?.(\"RelayerSDKLoader: relayerSDK.__initialized__ is invalid\");\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function isFhevmWindowType(\r\n  win: unknown,\r\n  trace?: TraceType\r\n): win is FhevmWindowType {\r\n  if (typeof win === \"undefined\") {\r\n    trace?.(\"RelayerSDKLoader: window object is undefined\");\r\n    return false;\r\n  }\r\n  if (win === null) {\r\n    trace?.(\"RelayerSDKLoader: window object is null\");\r\n    return false;\r\n  }\r\n  if (typeof win !== \"object\") {\r\n    trace?.(\"RelayerSDKLoader: window is not an object\");\r\n    return false;\r\n  }\r\n  if (!(\"relayerSDK\" in win)) {\r\n    trace?.(\"RelayerSDKLoader: window does not contain 'relayerSDK' property\");\r\n    return false;\r\n  }\r\n  return isFhevmRelayerSDKType(win.relayerSDK);\r\n}\r\n\r\nfunction objHasProperty<\r\n  T extends object,\r\n  K extends PropertyKey,\r\n  V extends string\r\n>(\r\n  obj: T,\r\n  propertyName: K,\r\n  propertyType: V,\r\n  trace?: TraceType\r\n): obj is T &\r\n  Record<\r\n    K,\r\n    V extends \"string\"\r\n      ? string\r\n      : V extends \"number\"\r\n      ? number\r\n      : V extends \"object\"\r\n      ? object\r\n      : V extends \"boolean\"\r\n      ? boolean\r\n      : V extends \"function\"\r\n      ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (...args: any[]) => any\r\n      : unknown\r\n  > {\r\n  if (!obj || typeof obj !== \"object\") {\r\n    return false;\r\n  }\r\n\r\n  if (!(propertyName in obj)) {\r\n    trace?.(`RelayerSDKLoader: missing ${String(propertyName)}.`);\r\n    return false;\r\n  }\r\n\r\n  const value = (obj as Record<K, unknown>)[propertyName];\r\n\r\n  if (value === null || value === undefined) {\r\n    trace?.(`RelayerSDKLoader: ${String(propertyName)} is null or undefined.`);\r\n    return false;\r\n  }\r\n\r\n  if (typeof value !== propertyType) {\r\n    trace?.(\r\n      `RelayerSDKLoader: ${String(propertyName)} is not a ${propertyType}.`\r\n    );\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 155, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/internal/PublicKeyStorage.ts"],"sourcesContent":["import { openDB, DBSchema, IDBPDatabase } from \"idb\";\r\n\r\ntype FhevmStoredPublicKey = {\r\n  publicKeyId: string;\r\n  publicKey: Uint8Array;\r\n};\r\n\r\ntype FhevmStoredPublicParams = {\r\n  publicParamsId: string;\r\n  publicParams: Uint8Array;\r\n};\r\n\r\ninterface PublicParamsDB extends DBSchema {\r\n  publicKeyStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicKey;\r\n    };\r\n  };\r\n  paramsStore: {\r\n    key: string;\r\n    value: {\r\n      acl: `0x${string}`;\r\n      value: FhevmStoredPublicParams;\r\n    };\r\n  };\r\n}\r\n\r\nlet __dbPromise: Promise<IDBPDatabase<PublicParamsDB>> | undefined = undefined;\r\n\r\nasync function _getDB(): Promise<IDBPDatabase<PublicParamsDB> | undefined> {\r\n  if (__dbPromise) {\r\n    return __dbPromise;\r\n  }\r\n  if (typeof window === \"undefined\") {\r\n    return undefined;\r\n  }\r\n  __dbPromise = openDB<PublicParamsDB>(\"fhevm\", 1, {\r\n    upgrade(db) {\r\n      if (!db.objectStoreNames.contains(\"paramsStore\")) {\r\n        db.createObjectStore(\"paramsStore\", { keyPath: \"acl\" });\r\n      }\r\n      if (!db.objectStoreNames.contains(\"publicKeyStore\")) {\r\n        db.createObjectStore(\"publicKeyStore\", { keyPath: \"acl\" });\r\n      }\r\n    },\r\n  });\r\n  return __dbPromise;\r\n}\r\n\r\ntype FhevmInstanceConfigPublicKey = {\r\n  data: Uint8Array | null;\r\n  id: string | null;\r\n};\r\n\r\ntype FhevmInstanceConfigPublicParams = {\r\n  \"2048\": {\r\n    publicParamsId: string;\r\n    publicParams: Uint8Array;\r\n  };\r\n};\r\n\r\nfunction assertFhevmStoredPublicKey(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicKey | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicKey must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicKeyId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId does not exist`);\r\n  }\r\n  if (typeof value.publicKeyId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicKey.publicKeyId must be a string`);\r\n  }\r\n  if (!(\"publicKey\" in value)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey does not exist`);\r\n  }\r\n  if (!(value.publicKey instanceof Uint8Array)) {\r\n    throw new Error(`FhevmStoredPublicKey.publicKey must be a Uint8Array`);\r\n  }\r\n}\r\n\r\nfunction assertFhevmStoredPublicParams(\r\n  value: unknown\r\n): asserts value is FhevmStoredPublicParams | null {\r\n  if (typeof value !== \"object\") {\r\n    throw new Error(`FhevmStoredPublicParams must be an object`);\r\n  }\r\n  if (value === null) {\r\n    return;\r\n  }\r\n  if (!(\"publicParamsId\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId does not exist`);\r\n  }\r\n  if (typeof value.publicParamsId !== \"string\") {\r\n    throw new Error(`FhevmStoredPublicParams.publicParamsId must be a string`);\r\n  }\r\n  if (!(\"publicParams\" in value)) {\r\n    throw new Error(`FhevmStoredPublicParams.publicParams does not exist`);\r\n  }\r\n  if (!(value.publicParams instanceof Uint8Array)) {\r\n    throw new Error(\r\n      `FhevmStoredPublicParams.publicParams must be a Uint8Array`\r\n    );\r\n  }\r\n}\r\n\r\nexport async function publicKeyStorageGet(aclAddress: `0x${string}`): Promise<{\r\n  publicKey?: FhevmInstanceConfigPublicKey;\r\n  publicParams: FhevmInstanceConfigPublicParams | null;\r\n}> {\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return { publicParams: null };\r\n  }\r\n\r\n  let storedPublicKey: FhevmStoredPublicKey | null = null;\r\n  try {\r\n    const pk = await db.get(\"publicKeyStore\", aclAddress);\r\n    if (pk?.value) {\r\n      assertFhevmStoredPublicKey(pk.value);\r\n      storedPublicKey = pk.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  let storedPublicParams: FhevmStoredPublicParams | null = null;\r\n  try {\r\n    const pp = await db.get(\"paramsStore\", aclAddress);\r\n    if (pp?.value) {\r\n      assertFhevmStoredPublicParams(pp.value);\r\n      storedPublicParams = pp.value;\r\n    }\r\n  } catch {\r\n    //\r\n  }\r\n\r\n  const publicKeyData = storedPublicKey?.publicKey;\r\n  const publicKeyId = storedPublicKey?.publicKeyId;\r\n  const publicParams = storedPublicParams\r\n    ? {\r\n        \"2048\": storedPublicParams,\r\n      }\r\n    : null;\r\n\r\n  let publicKey: FhevmInstanceConfigPublicKey | undefined = undefined;\r\n\r\n  if (publicKeyId && publicKeyData) {\r\n    publicKey = {\r\n      id: publicKeyId,\r\n      data: publicKeyData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...(publicKey !== undefined && { publicKey }),\r\n    publicParams,\r\n  };\r\n}\r\n\r\nexport async function publicKeyStorageSet(\r\n  aclAddress: `0x${string}`,\r\n  publicKey: FhevmStoredPublicKey | null,\r\n  publicParams: FhevmStoredPublicParams | null\r\n) {\r\n  assertFhevmStoredPublicKey(publicKey);\r\n  assertFhevmStoredPublicParams(publicParams);\r\n\r\n  const db = await _getDB();\r\n  if (!db) {\r\n    return;\r\n  }\r\n\r\n  if (publicKey) {\r\n    await db.put(\"publicKeyStore\", { acl: aclAddress, value: publicKey });\r\n  }\r\n\r\n  if (publicParams) {\r\n    await db.put(\"paramsStore\", { acl: aclAddress, value: publicParams });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 299, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/internal/fhevm.ts"],"sourcesContent":["import { isAddress, Eip1193Provider, JsonRpcProvider } from \"ethers\";\r\nimport type {\r\n  FhevmInitSDKOptions,\r\n  FhevmInitSDKType,\r\n  FhevmLoadSDKType,\r\n  FhevmWindowType,\r\n} from \"./fhevmTypes\";\r\nimport { isFhevmWindowType, RelayerSDKLoader } from \"./RelayerSDKLoader\";\r\nimport { publicKeyStorageGet, publicKeyStorageSet } from \"./PublicKeyStorage\";\r\nimport { FhevmInstance, FhevmInstanceConfig } from \"../fhevmTypes\";\r\n\r\nexport class FhevmReactError extends Error {\r\n  code: string;\r\n  constructor(code: string, message?: string, options?: ErrorOptions) {\r\n    super(message, options);\r\n    this.code = code;\r\n    this.name = \"FhevmReactError\";\r\n  }\r\n}\r\n\r\nfunction throwFhevmError(\r\n  code: string,\r\n  message?: string,\r\n  cause?: unknown\r\n): never {\r\n  throw new FhevmReactError(code, message, cause ? { cause } : undefined);\r\n}\r\n\r\nconst isFhevmInitialized = (): boolean => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    return false;\r\n  }\r\n  return window.relayerSDK.__initialized__ === true;\r\n};\r\n\r\nconst fhevmLoadSDK: FhevmLoadSDKType = () => {\r\n  const loader = new RelayerSDKLoader({ trace: console.log });\r\n  return loader.load();\r\n};\r\n\r\nconst fhevmInitSDK: FhevmInitSDKType = async (\r\n  options?: FhevmInitSDKOptions\r\n) => {\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    throw new Error(\"window.relayerSDK is not available\");\r\n  }\r\n  const result = await window.relayerSDK.initSDK(options);\r\n  window.relayerSDK.__initialized__ = result;\r\n  if (!result) {\r\n    throw new Error(\"window.relayerSDK.initSDK failed.\");\r\n  }\r\n  return true;\r\n};\r\n\r\nfunction checkIsAddress(a: unknown): a is `0x${string}` {\r\n  if (typeof a !== \"string\") {\r\n    return false;\r\n  }\r\n  if (!isAddress(a)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport class FhevmAbortError extends Error {\r\n  constructor(message = \"FHEVM operation was cancelled\") {\r\n    super(message);\r\n    this.name = \"FhevmAbortError\";\r\n  }\r\n}\r\n\r\ntype FhevmRelayerStatusType =\r\n  | \"sdk-loading\"\r\n  | \"sdk-loaded\"\r\n  | \"sdk-initializing\"\r\n  | \"sdk-initialized\"\r\n  | \"creating\";\r\n\r\nasync function getChainId(\r\n  providerOrUrl: Eip1193Provider | string\r\n): Promise<number> {\r\n  try {\r\n    if (typeof providerOrUrl === \"string\") {\r\n      const provider = new JsonRpcProvider(providerOrUrl, undefined, {\r\n        staticNetwork: true,\r\n      });\r\n      // Add timeout and better error handling\r\n      const network = await Promise.race([\r\n        provider.getNetwork(),\r\n        new Promise<never>((_, reject) =>\r\n          setTimeout(() => reject(new Error(\"Network request timeout\")), 10000)\r\n        ),\r\n      ]);\r\n      provider.destroy();\r\n      return Number(network.chainId);\r\n    }\r\n    // For EIP1193 provider, add timeout\r\n    const chainId = await Promise.race([\r\n      providerOrUrl.request({ method: \"eth_chainId\" }),\r\n      new Promise<never>((_, reject) =>\r\n        setTimeout(() => reject(new Error(\"Provider request timeout\")), 10000)\r\n      ),\r\n    ]);\r\n    return Number.parseInt(chainId as string, 16);\r\n  } catch (error: any) {\r\n    const errorMessage = error?.message || String(error);\r\n    // Completely suppress \"Failed to fetch\" errors - they're non-fatal\r\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\r\n      // Silently return a default chainId for string URLs, or throw a non-fetch error for providers\r\n      if (typeof providerOrUrl === \"string\") {\r\n        // For string URLs, try to infer from URL\r\n        if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\r\n          return 31337; // Assume localhost is Hardhat\r\n        }\r\n        // Can't determine, but don't throw - let caller handle\r\n        throw new Error(\"CHAIN_ID_UNAVAILABLE\");\r\n      }\r\n      // For EIP1193 providers, we need chainId, but don't throw fetch error\r\n      throw new Error(\"CHAIN_ID_UNAVAILABLE\");\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function getWeb3Client(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl, undefined, {\r\n    staticNetwork: true,\r\n  });\r\n  try {\r\n    // Add timeout to prevent hanging\r\n    const version = await Promise.race([\r\n      rpc.send(\"web3_clientVersion\", []),\r\n      new Promise<never>((_, reject) =>\r\n        setTimeout(() => reject(new Error(\"RPC request timeout\")), 10000)\r\n      ),\r\n    ]);\r\n    return version;\r\n  } catch (e: any) {\r\n    // Don't throw error - let caller handle it gracefully\r\n    // This is expected if the node is not running or not accessible\r\n    throw e;\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\nasync function tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl: string): Promise<\r\n  | {\r\n      ACLAddress: `0x${string}`;\r\n      InputVerifierAddress: `0x${string}`;\r\n      KMSVerifierAddress: `0x${string}`;\r\n    }\r\n  | undefined\r\n> {\r\n  try {\r\n    const version = await getWeb3Client(rpcUrl);\r\n    if (\r\n      typeof version !== \"string\" ||\r\n      !version.toLowerCase().includes(\"hardhat\")\r\n    ) {\r\n      // Not a Hardhat Node - this is normal, not an error\r\n      return undefined;\r\n    }\r\n  } catch (e: any) {\r\n    // Failed to connect - this is expected if node is not running\r\n    // Silently return undefined instead of throwing\r\n    console.debug(`[FHEVM] Could not connect to ${rpcUrl} - this is normal if using a different network or if the node is not running`);\r\n    return undefined;\r\n  }\r\n\r\n  try {\r\n    const metadata = await getFHEVMRelayerMetadata(rpcUrl);\r\n    if (!metadata || typeof metadata !== \"object\") {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"ACLAddress\" in metadata &&\r\n        typeof metadata.ACLAddress === \"string\" &&\r\n        metadata.ACLAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"InputVerifierAddress\" in metadata &&\r\n        typeof metadata.InputVerifierAddress === \"string\" &&\r\n        metadata.InputVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    if (\r\n      !(\r\n        \"KMSVerifierAddress\" in metadata &&\r\n        typeof metadata.KMSVerifierAddress === \"string\" &&\r\n        metadata.KMSVerifierAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return undefined;\r\n    }\r\n    return metadata;\r\n  } catch (e: any) {\r\n    // Not a FHEVM Hardhat Node or connection failed - this is normal\r\n    // Silently return undefined instead of throwing\r\n    const errorMsg = e?.message || String(e);\r\n    if (errorMsg.includes(\"Failed to fetch\") || errorMsg.includes(\"fetch\")) {\r\n      console.debug(`[FHEVM] Could not fetch relayer metadata from ${rpcUrl} - this is normal if not using FHEVM Hardhat node`);\r\n    } else {\r\n      console.debug(`[FHEVM] Relayer metadata not available from ${rpcUrl} - this is normal`);\r\n    }\r\n    return undefined;\r\n  }\r\n}\r\n\r\nasync function getFHEVMRelayerMetadata(rpcUrl: string) {\r\n  const rpc = new JsonRpcProvider(rpcUrl, undefined, {\r\n    staticNetwork: true,\r\n  });\r\n  try {\r\n    // Add timeout to prevent hanging\r\n    const version = await Promise.race([\r\n      rpc.send(\"fhevm_relayer_metadata\", []),\r\n      new Promise<never>((_, reject) =>\r\n        setTimeout(() => reject(new Error(\"RPC request timeout\")), 10000)\r\n      ),\r\n    ]);\r\n    return version;\r\n  } catch (e: any) {\r\n    // Don't throw error - let caller handle it gracefully\r\n    // This is expected if the node doesn't support FHEVM\r\n    throw e;\r\n  } finally {\r\n    rpc.destroy();\r\n  }\r\n}\r\n\r\ntype MockResolveResult = { isMock: true; chainId: number; rpcUrl: string };\r\ntype GenericResolveResult = { isMock: false; chainId: number; rpcUrl?: string };\r\ntype ResolveResult = MockResolveResult | GenericResolveResult;\r\n\r\nasync function resolve(\r\n  providerOrUrl: Eip1193Provider | string,\r\n  mockChains?: Record<number, string>\r\n): Promise<ResolveResult> {\r\n  try {\r\n    const chainId = await getChainId(providerOrUrl);\r\n    let rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n\r\n    const _mockChains: Record<number, string> = {\r\n      31337: \"http://localhost:8545\",\r\n      ...(mockChains ?? {}),\r\n    };\r\n\r\n    if (Object.hasOwn(_mockChains, chainId)) {\r\n      if (!rpcUrl) {\r\n        rpcUrl = _mockChains[chainId];\r\n      }\r\n      return { isMock: true, chainId, rpcUrl };\r\n    }\r\n\r\n    return { isMock: false, chainId, rpcUrl };\r\n  } catch (error: any) {\r\n    // If we can't get chainId, but providerOrUrl is a string (RPC URL),\r\n    // we can still try to use it as a mock chain if it matches\r\n    if (typeof providerOrUrl === \"string\") {\r\n      const _mockChains: Record<number, string> = {\r\n        31337: \"http://localhost:8545\",\r\n        ...(mockChains ?? {}),\r\n      };\r\n      \r\n      // Check if the URL matches any mock chain\r\n      for (const [chainId, url] of Object.entries(_mockChains)) {\r\n        if (providerOrUrl === url || providerOrUrl.includes(url.replace(\"http://\", \"\").replace(\"https://\", \"\"))) {\r\n          console.debug(`[FHEVM] Using mock chain ${chainId} for ${providerOrUrl} (chainId fetch failed but URL matches)`);\r\n          return { isMock: true, chainId: Number(chainId), rpcUrl: providerOrUrl };\r\n        }\r\n      }\r\n      \r\n      // If it's a localhost URL, assume it's mock chain 31337\r\n      if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\r\n        console.debug(`[FHEVM] Assuming localhost URL ${providerOrUrl} is mock chain 31337`);\r\n        return { isMock: true, chainId: 31337, rpcUrl: providerOrUrl };\r\n      }\r\n    }\r\n    \r\n    // Completely suppress \"Failed to fetch\" errors\r\n    const errorMessage = error?.message || String(error);\r\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\") || errorMessage === \"CHAIN_ID_UNAVAILABLE\") {\r\n      // For string URLs, try to infer from URL pattern\r\n      if (typeof providerOrUrl === \"string\") {\r\n        const _mockChains: Record<number, string> = {\r\n          31337: \"http://localhost:8545\",\r\n          ...(mockChains ?? {}),\r\n        };\r\n        \r\n        // Check if the URL matches any mock chain\r\n        for (const [chainId, url] of Object.entries(_mockChains)) {\r\n          if (providerOrUrl === url || providerOrUrl.includes(url.replace(\"http://\", \"\").replace(\"https://\", \"\"))) {\r\n            return { isMock: true, chainId: Number(chainId), rpcUrl: providerOrUrl };\r\n          }\r\n        }\r\n        \r\n        // If it's a localhost URL, assume it's mock chain 31337\r\n        if (providerOrUrl.includes(\"localhost\") || providerOrUrl.includes(\"127.0.0.1\")) {\r\n          return { isMock: true, chainId: 31337, rpcUrl: providerOrUrl };\r\n        }\r\n      }\r\n      \r\n      // For EIP1193 providers, can't determine chainId, return as non-mock\r\n      // This is fine - the instance will work without mock mode\r\n      return { isMock: false, chainId: 0, rpcUrl: undefined };\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport const createFhevmInstance = async (parameters: {\r\n  provider: Eip1193Provider | string;\r\n  mockChains?: Record<number, string>;\r\n  signal: AbortSignal;\r\n  onStatusChange?: (status: FhevmRelayerStatusType) => void;\r\n}): Promise<FhevmInstance> => {\r\n  const throwIfAborted = () => {\r\n    if (signal.aborted) throw new FhevmAbortError();\r\n  };\r\n\r\n  const notify = (status: FhevmRelayerStatusType) => {\r\n    if (onStatusChange) onStatusChange(status);\r\n  };\r\n\r\n  const {\r\n    signal,\r\n    onStatusChange,\r\n    provider: providerOrUrl,\r\n    mockChains,\r\n  } = parameters;\r\n\r\n  let isMock: boolean;\r\n  let rpcUrl: string | undefined;\r\n  let chainId: number;\r\n  \r\n  try {\r\n    const resolved = await resolve(providerOrUrl, mockChains);\r\n    isMock = resolved.isMock;\r\n    rpcUrl = resolved.rpcUrl;\r\n    chainId = resolved.chainId;\r\n  } catch (error: any) {\r\n    // Completely suppress \"Failed to fetch\" errors in resolve\r\n    const errorMessage = error?.message || String(error);\r\n    if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\r\n      // Fallback: assume non-mock mode\r\n      isMock = false;\r\n      rpcUrl = typeof providerOrUrl === \"string\" ? providerOrUrl : undefined;\r\n      chainId = 0;\r\n    } else {\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  if (isMock) {\r\n    const fhevmRelayerMetadata =\r\n      await tryFetchFHEVMHardhatNodeRelayerMetadata(rpcUrl);\r\n\r\n    if (fhevmRelayerMetadata) {\r\n      notify(\"creating\");\r\n      const fhevmMock = await import(\"./mock/fhevmMock\");\r\n      const mockInstance = await fhevmMock.fhevmMockCreateInstance({\r\n        rpcUrl,\r\n        chainId,\r\n        metadata: fhevmRelayerMetadata,\r\n      });\r\n\r\n      throwIfAborted();\r\n      return mockInstance;\r\n    }\r\n  }\r\n\r\n  throwIfAborted();\r\n\r\n  if (!isFhevmWindowType(window, console.log)) {\r\n    notify(\"sdk-loading\");\r\n    await fhevmLoadSDK();\r\n    throwIfAborted();\r\n    notify(\"sdk-loaded\");\r\n  }\r\n\r\n  if (!isFhevmInitialized()) {\r\n    notify(\"sdk-initializing\");\r\n    await fhevmInitSDK();\r\n    throwIfAborted();\r\n    notify(\"sdk-initialized\");\r\n  }\r\n\r\n  const relayerSDK = (window as unknown as FhevmWindowType).relayerSDK;\r\n\r\n  const aclAddress = relayerSDK.SepoliaConfig.aclContractAddress;\r\n  if (!checkIsAddress(aclAddress)) {\r\n    throw new Error(`Invalid address: ${aclAddress}`);\r\n  }\r\n\r\n  const pub = await publicKeyStorageGet(aclAddress);\r\n  throwIfAborted();\r\n\r\n  const config: FhevmInstanceConfig = {\r\n    ...relayerSDK.SepoliaConfig,\r\n    network: providerOrUrl,\r\n    publicKey: pub.publicKey,\r\n    publicParams: pub.publicParams,\r\n  };\r\n\r\n  notify(\"creating\");\r\n\r\n  const instance = await relayerSDK.createInstance(config);\r\n\r\n  await publicKeyStorageSet(\r\n    aclAddress,\r\n    instance.getPublicKey(),\r\n    instance.getPublicParams(2048)\r\n  );\r\n\r\n  throwIfAborted();\r\n\r\n  return instance;\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 657, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/useFhevm.tsx"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport type { FhevmInstance } from \"./fhevmTypes\";\r\nimport { createFhevmInstance } from \"./internal/fhevm\";\r\n\r\nfunction _assert(condition: boolean, message?: string): asserts condition {\r\n  if (!condition) {\r\n    const m = message ? `Assertion failed: ${message}` : `Assertion failed.`;\r\n    console.error(m);\r\n    throw new Error(m);\r\n  }\r\n}\r\n\r\nexport type FhevmGoState = \"idle\" | \"loading\" | \"ready\" | \"error\";\r\n\r\nexport function useFhevm(parameters: {\r\n  provider: string | ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  enabled?: boolean;\r\n  initialMockChains?: Readonly<Record<number, string>>;  \r\n}): {\r\n  instance: FhevmInstance | undefined;\r\n  refresh: () => void;\r\n  error: Error | undefined;\r\n  status: FhevmGoState;\r\n} {\r\n  const { provider, chainId, initialMockChains, enabled = true } = parameters;\r\n\r\n  const [instance, _setInstance] = useState<FhevmInstance | undefined>(\r\n    undefined\r\n  );\r\n  const [status, _setStatus] = useState<FhevmGoState>(\"idle\");\r\n  const [error, _setError] = useState<Error | undefined>(undefined);\r\n  const [_isRunning, _setIsRunning] = useState<boolean>(enabled);\r\n  const [_providerChanged, _setProviderChanged] = useState<number>(0);\r\n  const _abortControllerRef = useRef<AbortController | null>(null);\r\n  const _providerRef = useRef<string | ethers.Eip1193Provider | undefined>(\r\n    provider\r\n  );\r\n  const _chainIdRef = useRef<number | undefined>(chainId);\r\n  const _mockChainsRef = useRef<Record<number, string> | undefined>(\r\n    initialMockChains\r\n  );\r\n\r\n  const refresh = useCallback(() => {\r\n    if (_abortControllerRef.current) {\r\n      _providerRef.current = undefined;\r\n      _chainIdRef.current = undefined;\r\n      _abortControllerRef.current.abort();\r\n      _abortControllerRef.current = null;\r\n    }\r\n\r\n    _providerRef.current = provider;\r\n    _chainIdRef.current = chainId;\r\n    _setInstance(undefined);\r\n    _setError(undefined);\r\n    _setStatus(\"idle\");\r\n\r\n    if (provider !== undefined) {\r\n      _setProviderChanged((prev) => prev + 1);\r\n    }\r\n  }, [provider, chainId]);\r\n\r\n  useEffect(() => {\r\n    refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    _setIsRunning(enabled);\r\n  }, [enabled]);\r\n\r\n  useEffect(() => {\r\n      if (_isRunning === false) {\r\n        // Suppress cancelled log - this is normal behavior\r\n        if (_abortControllerRef.current) {\r\n        _abortControllerRef.current.abort();\r\n        _abortControllerRef.current = null;\r\n      }\r\n      _setInstance(undefined);\r\n      _setError(undefined);\r\n      _setStatus(\"idle\");\r\n      return;\r\n    }\r\n\r\n    if (_isRunning === true) {\r\n      if (_providerRef.current === undefined) {\r\n        _setInstance(undefined);\r\n        _setError(undefined);\r\n        _setStatus(\"idle\");\r\n        return;\r\n      }\r\n\r\n      if (!_abortControllerRef.current) {\r\n        _abortControllerRef.current = new AbortController();\r\n      }\r\n\r\n      _assert(\r\n        !_abortControllerRef.current.signal.aborted,\r\n        \"!controllerRef.current.signal.aborted\"\r\n      );\r\n\r\n      _setStatus(\"loading\");\r\n      _setError(undefined);\r\n\r\n      const thisSignal = _abortControllerRef.current.signal;\r\n      const thisProvider = _providerRef.current;\r\n      const thisRpcUrlsByChainId = _mockChainsRef.current;\r\n\r\n      createFhevmInstance({\r\n        signal: thisSignal,\r\n        provider: thisProvider,\r\n        mockChains: thisRpcUrlsByChainId,\r\n        onStatusChange: (s) =>\r\n          console.log(`[useFhevm] createFhevmInstance status changed: ${s}`),\r\n      })\r\n        .then((i) => {\r\n          console.log(`[useFhevm] createFhevmInstance created!`);\r\n          if (thisSignal.aborted) return;\r\n\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          _setInstance(i);\r\n          _setError(undefined);\r\n          _setStatus(\"ready\");\r\n        })\r\n        .catch((e) => {\r\n          if (thisSignal.aborted) {\r\n            return;\r\n          }\r\n\r\n          _assert(\r\n            thisProvider === _providerRef.current,\r\n            \"thisProvider === _providerRef.current\"\r\n          );\r\n\r\n          // Completely suppress \"Failed to fetch\" errors - they're non-fatal\r\n          const errorMessage = e?.message || String(e);\r\n          if (errorMessage.includes(\"Failed to fetch\") || errorMessage.includes(\"fetch\")) {\r\n            // Silently ignore - this is expected when RPC is not available\r\n            // The instance will work in non-mock mode or retry later\r\n            _setInstance(undefined);\r\n            _setError(undefined);\r\n            _setStatus(\"idle\");\r\n            return;\r\n          }\r\n\r\n          // Only log and set error for non-fetch errors\r\n          console.error(`[useFhevm] Error creating FHEVM instance:`, e);\r\n          const enhancedError = new Error(errorMessage);\r\n          enhancedError.name = e.name || \"FHEVMInitializationError\";\r\n          if (e.stack) {\r\n            enhancedError.stack = e.stack;\r\n          }\r\n\r\n          _setInstance(undefined);\r\n          _setError(enhancedError);\r\n          _setStatus(\"error\");\r\n        });\r\n    }\r\n  }, [_isRunning, _providerChanged]);\r\n\r\n  return { instance, refresh, error, status };\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 816, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/hooks/useEthersSigner.tsx"],"sourcesContent":["import { useMemo } from \"react\";\r\nimport { useWalletClient, usePublicClient } from \"wagmi\";\r\nimport { BrowserProvider, JsonRpcSigner, JsonRpcProvider } from \"ethers\";\r\n\r\nasync function walletClientToSigner(walletClient: any): Promise<JsonRpcSigner> {\r\n  const { account, chain, transport } = walletClient;\r\n  const network = {\r\n    chainId: chain.id,\r\n    name: chain.name,\r\n    ensAddress: chain.contracts?.ensRegistry?.address,\r\n  };\r\n\r\n  // Handle different transport types\r\n  let provider: BrowserProvider;\r\n  if (transport && typeof transport === \"object\" && \"request\" in transport) {\r\n    // EIP1193 provider\r\n    provider = new BrowserProvider(transport as any, network);\r\n  } else {\r\n    // Fallback to window.ethereum\r\n    if (typeof window !== \"undefined\" && (window as any).ethereum) {\r\n      provider = new BrowserProvider((window as any).ethereum, network);\r\n    } else {\r\n      throw new Error(\"No provider available\");\r\n    }\r\n  }\r\n  \r\n  const signer = await provider.getSigner(account.address);\r\n  return signer;\r\n}\r\n\r\nfunction publicClientToProvider(publicClient: any): JsonRpcProvider | undefined {\r\n  if (!publicClient) return undefined;\r\n  \r\n  const { chain, transport } = publicClient;\r\n  if (!chain) return undefined;\r\n\r\n  const network = {\r\n    chainId: chain.id,\r\n    name: chain.name,\r\n    ensAddress: chain.contracts?.ensRegistry?.address,\r\n  };\r\n\r\n  // Handle http transport\r\n  if (transport && typeof transport === \"object\") {\r\n    if (\"url\" in transport && typeof transport.url === \"string\") {\r\n      return new JsonRpcProvider(transport.url, network, { staticNetwork: true });\r\n    }\r\n    // Try to get URL from transport config\r\n    if (\"value\" in transport && transport.value && \"url\" in transport.value) {\r\n      return new JsonRpcProvider(transport.value.url, network, { staticNetwork: true });\r\n    }\r\n  }\r\n  \r\n  // Fallback: use chain RPC URL\r\n  if (chain.rpcUrls && chain.rpcUrls.default && chain.rpcUrls.default.http && chain.rpcUrls.default.http[0]) {\r\n    return new JsonRpcProvider(chain.rpcUrls.default.http[0], network, { staticNetwork: true });\r\n  }\r\n  \r\n  return undefined;\r\n}\r\n\r\nexport function useEthersSigner({ chainId }: { chainId?: number } = {}) {\r\n  const { data: walletClient } = useWalletClient({ chainId });\r\n  // Note: This returns a Promise, handle it in the component\r\n  return walletClient ? walletClientToSigner(walletClient) : undefined;\r\n}\r\n\r\nexport function useEthersProvider({ chainId }: { chainId?: number } = {}) {\r\n  const publicClient = usePublicClient({ chainId });\r\n  return useMemo(\r\n    () => publicClientToProvider(publicClient),\r\n    [publicClient]\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,eAAe,qBAAqB,YAAiB;QAKrC,8BAAA;IAJd,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IACtC,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IAEA,mCAAmC;IACnC,IAAI;IACJ,IAAI,aAAa,OAAO,cAAc,YAAY,aAAa,WAAW;QACxE,mBAAmB;QACnB,WAAW,IAAI,0MAAe,CAAC,WAAkB;IACnD,OAAO;QACL,8BAA8B;QAC9B,IAAI,aAAkB,eAAe,AAAC,OAAe,QAAQ,EAAE;YAC7D,WAAW,IAAI,0MAAe,CAAC,AAAC,OAAe,QAAQ,EAAE;QAC3D,OAAO;YACL,MAAM,IAAI,MAAM;QAClB;IACF;IAEA,MAAM,SAAS,MAAM,SAAS,SAAS,CAAC,QAAQ,OAAO;IACvD,OAAO;AACT;AAEA,SAAS,uBAAuB,YAAiB;QASjC,8BAAA;IARd,IAAI,CAAC,cAAc,OAAO;IAE1B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG;IAC7B,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,UAAU;QACd,SAAS,MAAM,EAAE;QACjB,MAAM,MAAM,IAAI;QAChB,UAAU,GAAE,mBAAA,MAAM,SAAS,cAAf,wCAAA,+BAAA,iBAAiB,WAAW,cAA5B,mDAAA,6BAA8B,OAAO;IACnD;IAEA,wBAAwB;IACxB,IAAI,aAAa,OAAO,cAAc,UAAU;QAC9C,IAAI,SAAS,aAAa,OAAO,UAAU,GAAG,KAAK,UAAU;YAC3D,OAAO,IAAI,0MAAe,CAAC,UAAU,GAAG,EAAE,SAAS;gBAAE,eAAe;YAAK;QAC3E;QACA,uCAAuC;QACvC,IAAI,WAAW,aAAa,UAAU,KAAK,IAAI,SAAS,UAAU,KAAK,EAAE;YACvE,OAAO,IAAI,0MAAe,CAAC,UAAU,KAAK,CAAC,GAAG,EAAE,SAAS;gBAAE,eAAe;YAAK;QACjF;IACF;IAEA,8BAA8B;IAC9B,IAAI,MAAM,OAAO,IAAI,MAAM,OAAO,CAAC,OAAO,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,IAAI,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE;QACzG,OAAO,IAAI,0MAAe,CAAC,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,SAAS;YAAE,eAAe;QAAK;IAC3F;IAEA,OAAO;AACT;AAEO,SAAS;QAAgB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACnE,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,IAAA,kMAAe,EAAC;QAAE;IAAQ;IACzD,2DAA2D;IAC3D,OAAO,eAAe,qBAAqB,gBAAgB;AAC7D;GAJgB;;QACiB,kMAAe;;;AAKzC,SAAS;QAAkB,EAAE,OAAO,EAAwB,GAAjC,iEAAoC,CAAC;;IACrE,MAAM,eAAe,IAAA,kMAAe,EAAC;QAAE;IAAQ;IAC/C,OAAO,IAAA,oLAAO;qCACZ,IAAM,uBAAuB;oCAC7B;QAAC;KAAa;AAElB;IANgB;;QACO,kMAAe","debugId":null}},
    {"offset": {"line": 925, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/fhevm/FhevmDecryptionSignature.ts"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport {\r\n  EIP712Type,\r\n  FhevmDecryptionSignatureType,\r\n  FhevmInstance,\r\n} from \"./fhevmTypes\";\r\nimport { GenericStringStorage } from \"./GenericStringStorage\";\r\n\r\nfunction _timestampNow(): number {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\nclass FhevmDecryptionSignatureStorageKey {\r\n  #contractAddresses: `0x${string}`[];\r\n  #userAddress: `0x${string}`;\r\n  #publicKey: string | undefined;\r\n  #key: string;\r\n\r\n  constructor(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ) {\r\n    if (!ethers.isAddress(userAddress)) {\r\n      throw new TypeError(`Invalid address ${userAddress}`);\r\n    }\r\n\r\n    const sortedContractAddresses = (\r\n      contractAddresses as `0x${string}`[]\r\n    ).sort();\r\n\r\n    const emptyEIP712 = instance.createEIP712(\r\n      publicKey ?? ethers.ZeroAddress,\r\n      sortedContractAddresses,\r\n      0,\r\n      0\r\n    );\r\n\r\n    try {\r\n      const hash = ethers.TypedDataEncoder.hash(\r\n        emptyEIP712.domain,\r\n        { UserDecryptRequestVerification: emptyEIP712.types.UserDecryptRequestVerification },\r\n        emptyEIP712.message\r\n      );\r\n\r\n      this.#contractAddresses = sortedContractAddresses;\r\n      this.#userAddress = userAddress as `0x${string}`;\r\n\r\n      this.#key = `${userAddress}:${hash}`;\r\n    } catch (e) {\r\n      console.log(e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  get contractAddresses(): `0x${string}`[] {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  get userAddress(): `0x${string}` {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  get publicKey(): string | undefined {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  get key(): string {\r\n    return this.#key;\r\n  }\r\n}\r\n\r\nexport class FhevmDecryptionSignature {\r\n  #publicKey: string;\r\n  #privateKey: string;\r\n  #signature: string;\r\n  #startTimestamp: number;\r\n  #durationDays: number;\r\n  #userAddress: `0x${string}`;\r\n  #contractAddresses: `0x${string}`[];\r\n  #eip712: EIP712Type;\r\n\r\n  private constructor(parameters: FhevmDecryptionSignatureType) {\r\n    if (!FhevmDecryptionSignature.checkIs(parameters)) {\r\n      throw new TypeError(\"Invalid FhevmDecryptionSignatureType\");\r\n    }\r\n    this.#publicKey = parameters.publicKey;\r\n    this.#privateKey = parameters.privateKey;\r\n    this.#signature = parameters.signature;\r\n    this.#startTimestamp = parameters.startTimestamp;\r\n    this.#durationDays = parameters.durationDays;\r\n    this.#userAddress = parameters.userAddress;\r\n    this.#contractAddresses = parameters.contractAddresses;\r\n    this.#eip712 = parameters.eip712;\r\n  }\r\n\r\n  public get privateKey() {\r\n    return this.#privateKey;\r\n  }\r\n\r\n  public get publicKey() {\r\n    return this.#publicKey;\r\n  }\r\n\r\n  public get signature() {\r\n    return this.#signature;\r\n  }\r\n\r\n  public get contractAddresses() {\r\n    return this.#contractAddresses;\r\n  }\r\n\r\n  public get startTimestamp() {\r\n    return this.#startTimestamp;\r\n  }\r\n\r\n  public get durationDays() {\r\n    return this.#durationDays;\r\n  }\r\n\r\n  public get userAddress() {\r\n    return this.#userAddress;\r\n  }\r\n\r\n  static checkIs(s: unknown): s is FhevmDecryptionSignatureType {\r\n    if (!s || typeof s !== \"object\") {\r\n      return false;\r\n    }\r\n    if (!(\"publicKey\" in s && typeof s.publicKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"privateKey\" in s && typeof s.privateKey === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"signature\" in s && typeof s.signature === \"string\")) {\r\n      return false;\r\n    }\r\n    if (!(\"startTimestamp\" in s && typeof s.startTimestamp === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"durationDays\" in s && typeof s.durationDays === \"number\")) {\r\n      return false;\r\n    }\r\n    if (!(\"contractAddresses\" in s && Array.isArray(s.contractAddresses))) {\r\n      return false;\r\n    }\r\n    for (let i = 0; i < s.contractAddresses.length; ++i) {\r\n      if (typeof s.contractAddresses[i] !== \"string\") return false;\r\n      if (!s.contractAddresses[i].startsWith(\"0x\")) return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"userAddress\" in s &&\r\n        typeof s.userAddress === \"string\" &&\r\n        s.userAddress.startsWith(\"0x\")\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"eip712\" in s && typeof s.eip712 === \"object\" && s.eip712 !== null)) {\r\n      return false;\r\n    }\r\n\r\n    if (!(\"domain\" in s.eip712 && typeof s.eip712.domain === \"object\")) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\"primaryType\" in s.eip712 && typeof s.eip712.primaryType === \"string\")\r\n    ) {\r\n      return false;\r\n    }\r\n    if (!(\"message\" in s.eip712)) {\r\n      return false;\r\n    }\r\n    if (\r\n      !(\r\n        \"types\" in s.eip712 &&\r\n        typeof s.eip712.types === \"object\" &&\r\n        s.eip712.types !== null\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      publicKey: this.#publicKey,\r\n      privateKey: this.#privateKey,\r\n      signature: this.#signature,\r\n      startTimestamp: this.#startTimestamp,\r\n      durationDays: this.#durationDays,\r\n      userAddress: this.#userAddress,\r\n      contractAddresses: this.#contractAddresses,\r\n      eip712: this.#eip712,\r\n    };\r\n  }\r\n\r\n  static fromJSON(json: unknown) {\r\n    const data = typeof json === \"string\" ? JSON.parse(json) : json;\r\n    return new FhevmDecryptionSignature(data);\r\n  }\r\n\r\n  equals(s: FhevmDecryptionSignatureType) {\r\n    return s.signature === this.#signature;\r\n  }\r\n\r\n  isValid(): boolean {\r\n    return (\r\n      _timestampNow() < this.#startTimestamp + this.#durationDays * 24 * 60 * 60\r\n    );\r\n  }\r\n\r\n  async saveToGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    withPublicKey: boolean\r\n  ) {\r\n    try {\r\n      const value = JSON.stringify(this);\r\n\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        this.#contractAddresses,\r\n        this.#userAddress,\r\n        withPublicKey ? this.#publicKey : undefined\r\n      );\r\n      await storage.setItem(storageKey.key, value);\r\n      console.log(\r\n        `signature saved! contracts=${this.#contractAddresses.length}`\r\n      );\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.saveToGenericStringStorage() failed!`\r\n      );\r\n    }\r\n  }\r\n\r\n  static async loadFromGenericStringStorage(\r\n    storage: GenericStringStorage,\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    userAddress: string,\r\n    publicKey?: string\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const storageKey = new FhevmDecryptionSignatureStorageKey(\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        publicKey\r\n      );\r\n\r\n      const result = await storage.getItem(storageKey.key);\r\n\r\n      if (!result) {\r\n        console.warn(`Could not load signature! key=${storageKey.key}`);\r\n        return null;\r\n      }\r\n\r\n      try {\r\n        const kps = FhevmDecryptionSignature.fromJSON(result);\r\n        if (!kps.isValid()) {\r\n          return null;\r\n        }\r\n\r\n        return kps;\r\n      } catch {\r\n        return null;\r\n      }\r\n    } catch {\r\n      console.error(\r\n        `FhevmDecryptionSignature.loadFromGenericStringStorage() failed!`\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async new(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    publicKey: string,\r\n    privateKey: string,\r\n    signer: ethers.Signer\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    try {\r\n      const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n      const startTimestamp = _timestampNow();\r\n      const durationDays = 365;\r\n      const eip712 = instance.createEIP712(\r\n        publicKey,\r\n        contractAddresses,\r\n        startTimestamp,\r\n        durationDays\r\n      );\r\n      const signature = await signer.signTypedData(\r\n        eip712.domain,\r\n        { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },\r\n        eip712.message\r\n      );\r\n      return new FhevmDecryptionSignature({\r\n        publicKey,\r\n        privateKey,\r\n        contractAddresses: contractAddresses as `0x${string}`[],\r\n        startTimestamp,\r\n        durationDays,\r\n        signature,\r\n        eip712: eip712 as EIP712Type,\r\n        userAddress,\r\n      });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  static async loadOrSign(\r\n    instance: FhevmInstance,\r\n    contractAddresses: string[],\r\n    signer: ethers.Signer,\r\n    storage: GenericStringStorage,\r\n    keyPair?: { publicKey: string; privateKey: string }\r\n  ): Promise<FhevmDecryptionSignature | null> {\r\n    const userAddress = (await signer.getAddress()) as `0x${string}`;\r\n\r\n    const cached: FhevmDecryptionSignature | null =\r\n      await FhevmDecryptionSignature.loadFromGenericStringStorage(\r\n        storage,\r\n        instance,\r\n        contractAddresses,\r\n        userAddress,\r\n        keyPair?.publicKey\r\n      );\r\n\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const { publicKey, privateKey } = keyPair ?? instance.generateKeypair();\r\n\r\n    const sig = await FhevmDecryptionSignature.new(\r\n      instance,\r\n      contractAddresses,\r\n      publicKey,\r\n      privateKey,\r\n      signer\r\n    );\r\n\r\n    if (!sig) {\r\n      return null;\r\n    }\r\n\r\n    await sig.saveToGenericStringStorage(\r\n      storage,\r\n      instance,\r\n      Boolean(keyPair?.publicKey)\r\n    );\r\n\r\n    return sig;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1202, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/abi/DreamJournalAddresses.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const DreamJournalAddresses = { \n  \"11155111\": { address: \"0xf3D18cC0b960Aed9e6B27E166dDed6bD11340F11\", chainId: 11155111, chainName: \"sepolia\" },\n  \"31337\": { address: \"0x5FbDB2315678afecb367f032d93F642f64180aa3\", chainId: 31337, chainName: \"hardhat\" },\n};\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,wBAAwB;IACnC,YAAY;QAAE,SAAS;QAA8C,SAAS;QAAU,WAAW;IAAU;IAC7G,SAAS;QAAE,SAAS;QAA8C,SAAS;QAAO,WAAW;IAAU;AACzG","debugId":null}},
    {"offset": {"line": 1228, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/abi/DreamJournalABI.ts"],"sourcesContent":["\n/*\n  This file is auto-generated.\n  Command: 'npm run genabi'\n*/\nexport const DreamJournalABI = {\n  \"abi\": [\n    {\n      \"anonymous\": false,\n      \"inputs\": [\n        {\n          \"indexed\": true,\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"indexed\": true,\n          \"internalType\": \"address\",\n          \"name\": \"owner\",\n          \"type\": \"address\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"indexed\": false,\n          \"internalType\": \"uint64\",\n          \"name\": \"createdAt\",\n          \"type\": \"uint64\"\n        }\n      ],\n      \"name\": \"DreamCreated\",\n      \"type\": \"event\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"externalEuint8[]\",\n          \"name\": \"encContent\",\n          \"type\": \"bytes32[]\"\n        },\n        {\n          \"internalType\": \"bytes\",\n          \"name\": \"inputProof\",\n          \"type\": \"bytes\"\n        }\n      ],\n      \"name\": \"createDream\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"nonpayable\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        },\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"index\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamContentByte\",\n      \"outputs\": [\n        {\n          \"internalType\": \"euint8\",\n          \"name\": \"encByte\",\n          \"type\": \"bytes32\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamContentLength\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"length\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getDreamCount\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"count\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"user\",\n          \"type\": \"address\"\n        }\n      ],\n      \"name\": \"getDreamIds\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256[]\",\n          \"name\": \"ids\",\n          \"type\": \"uint256[]\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"id\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"name\": \"getDreamMeta\",\n      \"outputs\": [\n        {\n          \"internalType\": \"address\",\n          \"name\": \"owner\",\n          \"type\": \"address\"\n        },\n        {\n          \"internalType\": \"string\",\n          \"name\": \"title\",\n          \"type\": \"string\"\n        },\n        {\n          \"internalType\": \"uint64\",\n          \"name\": \"createdAt\",\n          \"type\": \"uint64\"\n        }\n      ],\n      \"stateMutability\": \"view\",\n      \"type\": \"function\"\n    },\n    {\n      \"inputs\": [],\n      \"name\": \"protocolId\",\n      \"outputs\": [\n        {\n          \"internalType\": \"uint256\",\n          \"name\": \"\",\n          \"type\": \"uint256\"\n        }\n      ],\n      \"stateMutability\": \"pure\",\n      \"type\": \"function\"\n    }\n  ]\n} as const;\n\n"],"names":[],"mappings":"AACA;;;AAGA;;;;AACO,MAAM,kBAAkB;IAC7B,OAAO;QACL;YACE,aAAa;YACb,UAAU;gBACR;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,WAAW;oBACX,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU;gBACR;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;gBACA;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;QACA;YACE,UAAU,EAAE;YACZ,QAAQ;YACR,WAAW;gBACT;oBACE,gBAAgB;oBAChB,QAAQ;oBACR,QAAQ;gBACV;aACD;YACD,mBAAmB;YACnB,QAAQ;QACV;KACD;AACH","debugId":null}},
    {"offset": {"line": 1429, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/hooks/useDreamJournal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { ethers } from \"ethers\";\r\nimport {\r\n  RefObject,\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport { FhevmInstance } from \"@/fhevm/fhevmTypes\";\r\nimport { FhevmDecryptionSignature } from \"@/fhevm/FhevmDecryptionSignature\";\r\nimport { GenericStringStorage } from \"@/fhevm/GenericStringStorage\";\r\nimport { DreamJournalAddresses } from \"@/abi/DreamJournalAddresses\";\r\nimport { DreamJournalABI } from \"@/abi/DreamJournalABI\";\r\n\r\ntype DreamInfoType = {\r\n  abi: typeof DreamJournalABI.abi;\r\n  address?: `0x${string}`;\r\n  chainId?: number;\r\n  chainName?: string;\r\n};\r\n\r\nexport type Dream = {\r\n  id: bigint;\r\n  title: string;\r\n  owner: string;\r\n  createdAt: bigint;\r\n  decryptedContent?: string;\r\n  isDecrypting?: boolean;\r\n};\r\n\r\n/**\r\n * Resolves DreamJournal contract metadata for the given EVM `chainId`.\r\n */\r\nfunction getDreamJournalByChainId(\r\n  chainId: number | undefined\r\n): DreamInfoType {\r\n  if (!chainId) {\r\n    return { abi: DreamJournalABI.abi };\r\n  }\r\n\r\n  const entry =\r\n    DreamJournalAddresses[chainId.toString() as keyof typeof DreamJournalAddresses];\r\n\r\n  if (!(\"address\" in entry) || entry.address === ethers.ZeroAddress) {\r\n    return { abi: DreamJournalABI.abi, chainId };\r\n  }\r\n\r\n  return {\r\n    address: entry?.address as `0x${string}` | undefined,\r\n    chainId: entry?.chainId ?? chainId,\r\n    chainName: entry?.chainName,\r\n    abi: DreamJournalABI.abi,\r\n  };\r\n}\r\n\r\nexport const useDreamJournal = (parameters: {\r\n  instance: FhevmInstance | undefined;\r\n  fhevmDecryptionSignatureStorage: GenericStringStorage;\r\n  eip1193Provider: ethers.Eip1193Provider | undefined;\r\n  chainId: number | undefined;\r\n  ethersSigner: ethers.JsonRpcSigner | undefined;\r\n  ethersReadonlyProvider: ethers.ContractRunner | undefined;\r\n  sameChain: RefObject<(chainId: number | undefined) => boolean>;\r\n  sameSigner: RefObject<\r\n    (ethersSigner: ethers.JsonRpcSigner | undefined) => boolean | Promise<boolean>\r\n  >;\r\n}) => {\r\n  const {\r\n    instance,\r\n    fhevmDecryptionSignatureStorage,\r\n    chainId,\r\n    ethersSigner,\r\n    ethersReadonlyProvider,\r\n    sameChain,\r\n    sameSigner,\r\n  } = parameters;\r\n\r\n  // States\r\n  const [dreams, setDreams] = useState<Dream[]>([]);\r\n  const [isLoading, setIsLoading] = useState<boolean>(false);\r\n  const [isCreating, setIsCreating] = useState<boolean>(false);\r\n  const [message, setMessage] = useState<string>(\"\");\r\n  \r\n  const dreamJournalRef = useRef<DreamInfoType | undefined>(undefined);\r\n  const isLoadingRef = useRef<boolean>(false);\r\n  const isCreatingRef = useRef<boolean>(false);\r\n\r\n  // Contract info\r\n  const dreamJournal = useMemo(() => {\r\n    const c = getDreamJournalByChainId(chainId);\r\n    dreamJournalRef.current = c;\r\n    if (!c.address) {\r\n      setMessage(`DreamJournal deployment not found for chainId=${chainId}.`);\r\n    }\r\n    return c;\r\n  }, [chainId]);\r\n\r\n  const isDeployed = useMemo(() => {\r\n    if (!dreamJournal) {\r\n      return undefined;\r\n    }\r\n    return Boolean(dreamJournal.address) && dreamJournal.address !== ethers.ZeroAddress;\r\n  }, [dreamJournal]);\r\n\r\n  const canCreate = useMemo(() => {\r\n    // Allow creating even if instance is not ready - it will be checked in createDream\r\n    return Boolean(dreamJournal.address && ethersSigner && !isCreating && !isLoading);\r\n  }, [dreamJournal.address, ethersSigner, isCreating, isLoading]);\r\n\r\n  const canLoadDreams = useMemo(() => {\r\n    return dreamJournal.address && ethersReadonlyProvider && ethersSigner && !isLoading;\r\n  }, [dreamJournal.address, ethersReadonlyProvider, ethersSigner, isLoading]);\r\n\r\n  // Load user's dreams\r\n  const loadDreams = useCallback(() => {\r\n    if (isLoadingRef.current) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !dreamJournalRef.current ||\r\n      !dreamJournalRef.current?.chainId ||\r\n      !dreamJournalRef.current?.address ||\r\n      !ethersReadonlyProvider ||\r\n      !ethersSigner\r\n    ) {\r\n      setDreams([]);\r\n      return;\r\n    }\r\n\r\n    isLoadingRef.current = true;\r\n    setIsLoading(true);\r\n    setMessage(\"Loading dreams...\");\r\n\r\n    const thisChainId = dreamJournalRef.current.chainId;\r\n    const thisContractAddress = dreamJournalRef.current.address;\r\n    const thisEthersReadonlyProvider = ethersReadonlyProvider;\r\n    const thisEthersSigner = ethersSigner;\r\n\r\n    const contract = new ethers.Contract(\r\n      thisContractAddress,\r\n      dreamJournalRef.current.abi,\r\n      thisEthersReadonlyProvider\r\n    );\r\n\r\n    const run = async () => {\r\n      try {\r\n        const userAddress = await thisEthersSigner.getAddress();\r\n        const dreamIds = await contract.getDreamIds(userAddress);\r\n        \r\n        if (\r\n          !sameChain.current(thisChainId) ||\r\n          thisContractAddress !== dreamJournalRef.current?.address\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        const dreamList: Dream[] = [];\r\n        \r\n        for (let i = 0; i < dreamIds.length; i++) {\r\n          const id = dreamIds[i];\r\n          const [owner, title, createdAt] = await contract.getDreamMeta(id);\r\n          \r\n          dreamList.push({\r\n            id: BigInt(id),\r\n            title,\r\n            owner,\r\n            createdAt: BigInt(createdAt),\r\n          });\r\n        }\r\n\r\n        if (\r\n          sameChain.current(thisChainId) &&\r\n          thisContractAddress === dreamJournalRef.current?.address\r\n        ) {\r\n          setDreams(dreamList);\r\n          setMessage(`Loaded ${dreamList.length} dream(s)`);\r\n        }\r\n      } catch (e) {\r\n        setMessage(\"Failed to load dreams: \" + e);\r\n        if (\r\n          sameChain.current(thisChainId) &&\r\n          thisContractAddress === dreamJournalRef.current?.address\r\n        ) {\r\n          setDreams([]);\r\n        }\r\n      } finally {\r\n        isLoadingRef.current = false;\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    run();\r\n  }, [ethersReadonlyProvider, ethersSigner, sameChain]);\r\n\r\n  // Auto load dreams - use ref to prevent infinite loop\r\n  const canLoadDreamsRef = useRef(false);\r\n  const lastLoadRef = useRef<string>(\"\");\r\n  const loadTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  \r\n  useEffect(() => {\r\n    canLoadDreamsRef.current = canLoadDreams;\r\n  }, [canLoadDreams]);\r\n\r\n  useEffect(() => {\r\n    // Clear any pending timeout\r\n    if (loadTimeoutRef.current) {\r\n      clearTimeout(loadTimeoutRef.current);\r\n      loadTimeoutRef.current = null;\r\n    }\r\n\r\n    // Create a unique key for this load attempt\r\n    const address = dreamJournal.address || \"\";\r\n    const loadKey = `${address}-${chainId}-${!!ethersReadonlyProvider}-${!!ethersSigner}`;\r\n    \r\n    // Only load if conditions changed and we haven't loaded for this key\r\n    if (canLoadDreams && loadKey !== lastLoadRef.current && !isLoadingRef.current) {\r\n      lastLoadRef.current = loadKey;\r\n      // Use setTimeout to debounce and prevent rapid calls\r\n      loadTimeoutRef.current = setTimeout(() => {\r\n        if (!isLoadingRef.current) {\r\n          loadDreams();\r\n        }\r\n        loadTimeoutRef.current = null;\r\n      }, 300); // Increased debounce time\r\n    }\r\n\r\n    return () => {\r\n      if (loadTimeoutRef.current) {\r\n        clearTimeout(loadTimeoutRef.current);\r\n        loadTimeoutRef.current = null;\r\n      }\r\n    };\r\n  }, [dreamJournal.address, chainId, ethersReadonlyProvider, ethersSigner, canLoadDreams, loadDreams]);\r\n\r\n  // Create new dream\r\n  const createDream = useCallback(\r\n    (title: string, content: string) => {\r\n      if (isCreatingRef.current || isLoadingRef.current) {\r\n        console.log(\"[createDream] Already creating or loading, ignoring duplicate call\");\r\n        return;\r\n      }\r\n\r\n      if (!dreamJournal.address || !ethersSigner || !title || !content) {\r\n        setMessage(\"Please fill in both title and content\");\r\n        return;\r\n      }\r\n\r\n      // Check instance only when actually creating\r\n      if (!instance) {\r\n        const errorMsg = \"FHEVM instance is not ready. Please wait for initialization...\";\r\n        setMessage(errorMsg);\r\n        console.error(\"[createDream] FHEVM instance not available:\", {\r\n          hasInstance: !!instance,\r\n          chainId,\r\n          contractAddress: dreamJournal.address,\r\n          hasSigner: !!ethersSigner,\r\n        });\r\n        isCreatingRef.current = false;\r\n        setIsCreating(false);\r\n        return;\r\n      }\r\n\r\n      const thisChainId = chainId;\r\n      const thisContractAddress = dreamJournal.address;\r\n      const thisEthersSigner = ethersSigner;\r\n      const thisContract = new ethers.Contract(\r\n        thisContractAddress,\r\n        dreamJournal.abi,\r\n        thisEthersSigner\r\n      );\r\n\r\n      isCreatingRef.current = true;\r\n      setIsCreating(true);\r\n      setMessage(\"Encrypting dream content...\");\r\n\r\n      const run = async () => {\r\n        // Let browser repaint before encryption (CPU-intensive)\r\n        await new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n        const isStale = () =>\r\n          thisContractAddress !== dreamJournalRef.current?.address ||\r\n          !sameChain.current(thisChainId) ||\r\n          !sameSigner.current(thisEthersSigner);\r\n\r\n        try {\r\n          // Convert string to bytes\r\n          const contentBytes = ethers.toUtf8Bytes(content);\r\n\r\n          // Encrypt each byte\r\n          const encryptedInput = instance.createEncryptedInput(\r\n            thisContractAddress,\r\n            thisEthersSigner.address\r\n          );\r\n\r\n          for (let i = 0; i < contentBytes.length; i++) {\r\n            encryptedInput.add8(contentBytes[i]);\r\n          }\r\n\r\n          // Encrypt (CPU-intensive)\r\n          console.log(\"[createDream] Starting encryption...\");\r\n          console.log(\"[createDream] Encryption context:\", {\r\n            contractAddress: thisContractAddress,\r\n            userAddress: thisEthersSigner.address,\r\n            chainId: thisChainId,\r\n            isMock: false, // Sepolia uses real relayer\r\n          });\r\n          \r\n          let encrypted;\r\n          try {\r\n            encrypted = await encryptedInput.encrypt();\r\n            console.log(\"[createDream] Encryption completed, handles:\", encrypted.handles.length);\r\n          } catch (encryptError: any) {\r\n            const errorMsg = encryptError?.message || String(encryptError);\r\n            console.error(\"[createDream] Encryption failed:\", {\r\n              error: errorMsg,\r\n              name: encryptError?.name,\r\n              stack: encryptError?.stack,\r\n            });\r\n            \r\n            // Provide user-friendly error message\r\n            if (errorMsg.includes(\"Relayer\") || errorMsg.includes(\"Bad JSON\")) {\r\n              throw new Error(\r\n                `FHEVM Relayer error: ${errorMsg}\\n\\n` +\r\n                `This may be a temporary issue with the FHEVM Relayer service on Sepolia.\\n` +\r\n                `Please try again in a few moments, or switch to Hardhat Local network for testing.`\r\n              );\r\n            }\r\n            throw encryptError;\r\n          }\r\n          console.log(\"[createDream] Handles type check:\", {\r\n            isArray: Array.isArray(encrypted.handles),\r\n            firstHandleType: typeof encrypted.handles[0],\r\n            firstHandleValue: encrypted.handles[0],\r\n          });\r\n\r\n          // Check if stale after encryption\r\n          const staleCheck = await isStale();\r\n          console.log(\"[createDream] Stale check after encryption:\", staleCheck);\r\n          if (staleCheck) {\r\n            const signerCheck = sameSigner.current(thisEthersSigner);\r\n            const signerMatch = typeof signerCheck === 'boolean' ? signerCheck : await signerCheck;\r\n            console.log(\"[createDream] Stale after encryption, aborting. Details:\", {\r\n              contractAddressMatch: thisContractAddress === dreamJournalRef.current?.address,\r\n              chainMatch: sameChain.current(thisChainId),\r\n              signerMatch: signerMatch,\r\n              currentAddress: dreamJournalRef.current?.address,\r\n              thisAddress: thisContractAddress,\r\n              currentChainId: dreamJournalRef.current?.chainId,\r\n              thisChainId,\r\n            });\r\n            setMessage(\"Ignore dream creation - state changed\");\r\n            isCreatingRef.current = false;\r\n            setIsCreating(false);\r\n            return;\r\n          }\r\n          \r\n          console.log(\"[createDream] Not stale, proceeding with transaction submission...\");\r\n\r\n          setMessage(\"Submitting dream to blockchain...\");\r\n          console.log(\"[createDream] Preparing transaction...\");\r\n          \r\n          try {\r\n            const signerAddress = await thisEthersSigner.getAddress();\r\n            console.log(\"[createDream] Contract instance:\", {\r\n              address: thisContractAddress,\r\n              hasContract: !!thisContract,\r\n              signerAddress,\r\n            });\r\n          } catch (addrError) {\r\n            console.error(\"[createDream] Error getting signer address:\", addrError);\r\n            throw new Error(\"Failed to get signer address\");\r\n          }\r\n\r\n          // ABI shows externalEuint8[] is compiled as bytes32[]\r\n          // So we pass handles directly as bytes32[] array, not as struct array\r\n          // The handles are already in the correct format (hex strings)\r\n          const handlesArray = encrypted.handles;\r\n\r\n          // Safe logging\r\n          const firstHandle = handlesArray[0];\r\n          const firstHandlePreview = typeof firstHandle === 'string' \r\n            ? firstHandle.substring(0, 20) + \"...\" \r\n            : String(firstHandle || 'undefined').substring(0, 30);\r\n\r\n          console.log(\"[createDream] Prepared handles array:\", {\r\n            arrayLength: handlesArray.length,\r\n            firstHandle: firstHandlePreview,\r\n            firstHandleType: typeof firstHandle,\r\n            hasInputProof: !!encrypted.inputProof,\r\n            inputProofLength: encrypted.inputProof?.length || 0,\r\n          });\r\n\r\n          // Call contract\r\n          console.log(\"[createDream] Calling createDream contract method...\", {\r\n            title,\r\n            encryptedBytes: handlesArray.length,\r\n            hasInputProof: !!encrypted.inputProof,\r\n            contractAddress: thisContractAddress,\r\n          });\r\n\r\n          const tx: ethers.TransactionResponse = await thisContract.createDream(\r\n            title,\r\n            handlesArray,\r\n            encrypted.inputProof\r\n          );\r\n          \r\n          console.log(\"[createDream] Transaction sent:\", tx.hash);\r\n          console.log(\"[createDream] Transaction details:\", {\r\n            hash: tx.hash,\r\n            to: tx.to,\r\n            from: tx.from,\r\n            value: tx.value?.toString(),\r\n          });\r\n          setMessage(`Wait for tx:${tx.hash}...`);\r\n\r\n          const receipt = await tx.wait();\r\n\r\n          setMessage(`Dream created! status=${receipt?.status}`);\r\n          console.log(\"[createDream] Dream created successfully!\", { txHash: tx.hash, status: receipt?.status });\r\n\r\n          if (await isStale()) {\r\n            setMessage(\"Ignore dream creation\");\r\n            isCreatingRef.current = false;\r\n            setIsCreating(false);\r\n            return;\r\n          }\r\n\r\n          // Reload dreams\r\n          loadDreams();\r\n          \r\n          // Signal success to component\r\n          setMessage(`Dream created successfully! Transaction: ${tx.hash.slice(0, 10)}...`);\r\n        } catch (e: any) {\r\n          const errorMsg = e?.message || \"Failed to create dream\";\r\n          setMessage(`Create dream failed: ${errorMsg}`);\r\n          console.error(\"[createDream] Error:\", e);\r\n          console.error(\"[createDream] Error details:\", {\r\n            name: e?.name,\r\n            message: errorMsg,\r\n            code: e?.code,\r\n            data: e?.data,\r\n            reason: e?.reason,\r\n            stack: e?.stack,\r\n          });\r\n          \r\n          // Show alert for user-friendly error message\r\n          if (errorMsg.includes(\"user rejected\") || errorMsg.includes(\"User denied\") || errorMsg.includes(\"rejected\") || errorMsg.includes(\"User rejected\")) {\r\n            alert(\"Transaction was cancelled. Please try again when ready.\");\r\n          } else if (errorMsg.includes(\"insufficient funds\") || errorMsg.includes(\"insufficient balance\")) {\r\n            alert(\"Insufficient funds. Please add ETH to your wallet.\");\r\n          } else if (errorMsg.includes(\"Relayer\") || errorMsg.includes(\"Bad JSON\")) {\r\n            alert(\r\n              \"FHEVM Relayer Error\\n\\n\" +\r\n              \"The FHEVM Relayer service on Sepolia may be temporarily unavailable or experiencing issues.\\n\\n\" +\r\n              \"Suggestions:\\n\" +\r\n              \"1. Wait a few moments and try again\\n\" +\r\n              \"2. Switch to Hardhat Local network for local testing\\n\" +\r\n              \"3. Check the browser console (F12) for more details\\n\\n\" +\r\n              `Error: ${errorMsg}`\r\n            );\r\n          } else if (errorMsg.includes(\"network\") || errorMsg.includes(\"Network\") || errorMsg.includes(\"ECONNREFUSED\")) {\r\n            alert(`Network error: ${errorMsg}\\n\\nPlease check:\\n1. Hardhat node is running (npx hardhat node)\\n2. Wallet is connected to Hardhat Local network (Chain ID: 31337)`);\r\n          } else {\r\n            alert(`Failed to create dream: ${errorMsg}\\n\\nCheck the browser console (F12) for more details.`);\r\n          }\r\n        } finally {\r\n          isCreatingRef.current = false;\r\n          setIsCreating(false);\r\n        }\r\n      };\r\n\r\n      run();\r\n    },\r\n    [\r\n      dreamJournal.address,\r\n      dreamJournal.abi,\r\n      instance,\r\n      chainId,\r\n      ethersSigner,\r\n      loadDreams,\r\n      sameChain,\r\n      sameSigner,\r\n    ]\r\n  );\r\n\r\n  // Decrypt dream content\r\n  const decryptDream = useCallback(\r\n    (dreamId: bigint) => {\r\n      if (isLoadingRef.current) {\r\n        return;\r\n      }\r\n\r\n      if (!dreamJournal.address || !instance || !ethersSigner || !ethersReadonlyProvider) {\r\n        return;\r\n      }\r\n\r\n      // Check if already decrypted\r\n      const dream = dreams.find((d) => d.id === dreamId);\r\n      if (dream?.decryptedContent) {\r\n        return;\r\n      }\r\n\r\n      const thisChainId = chainId;\r\n      const thisContractAddress = dreamJournal.address;\r\n      const thisEthersSigner = ethersSigner;\r\n      const thisEthersReadonlyProvider = ethersReadonlyProvider;\r\n\r\n      isLoadingRef.current = true;\r\n      setIsLoading(true);\r\n      \r\n      // Update dream state to show decrypting\r\n      setDreams((prev) =>\r\n        prev.map((d) => (d.id === dreamId ? { ...d, isDecrypting: true } : d))\r\n      );\r\n      setMessage(`Decrypting dream #${dreamId}...`);\r\n\r\n      const run = async () => {\r\n        const isStale = async () => {\r\n          const addressMatch = thisContractAddress === dreamJournalRef.current?.address;\r\n          const chainMatch = sameChain.current(thisChainId);\r\n          const signerCheck = sameSigner.current(thisEthersSigner);\r\n          const signerMatch = typeof signerCheck === 'boolean' ? signerCheck : await signerCheck;\r\n          return !addressMatch || !chainMatch || !signerMatch;\r\n        };\r\n\r\n        try {\r\n          const contract = new ethers.Contract(\r\n            thisContractAddress,\r\n            dreamJournalRef.current!.abi,\r\n            thisEthersReadonlyProvider\r\n          );\r\n\r\n          // Get content length\r\n          const length = await contract.getDreamContentLength(dreamId);\r\n          \r\n          if (await isStale()) {\r\n            return;\r\n          }\r\n\r\n          // Get decryption signature\r\n          const sig: FhevmDecryptionSignature | null =\r\n            await FhevmDecryptionSignature.loadOrSign(\r\n              instance,\r\n              [thisContractAddress as `0x${string}`],\r\n              thisEthersSigner,\r\n              fhevmDecryptionSignatureStorage\r\n            );\r\n\r\n          if (!sig) {\r\n            setMessage(\"Unable to build FHEVM decryption signature\");\r\n            return;\r\n          }\r\n\r\n          if (await isStale()) {\r\n            setMessage(\"Ignore decryption\");\r\n            return;\r\n          }\r\n\r\n          setMessage(\"Decrypting content...\");\r\n\r\n          // Decrypt each byte\r\n          const decryptedBytes: number[] = [];\r\n          \r\n          // Get all encrypted bytes first\r\n          const encryptedBytes: string[] = [];\r\n          for (let i = 0; i < Number(length); i++) {\r\n            if (await isStale()) {\r\n              return;\r\n            }\r\n            const encByte = await contract.getDreamContentByte(dreamId, i);\r\n            // Convert to bytes32 format (handle)\r\n            const handle = typeof encByte === \"string\" ? encByte : ethers.hexlify(encByte);\r\n            encryptedBytes.push(handle);\r\n          }\r\n\r\n          if (await isStale()) {\r\n            setMessage(\"Ignore decryption\");\r\n            return;\r\n          }\r\n\r\n          // Prepare handle-contract pairs for batch decryption\r\n          const handleContractPairs = encryptedBytes.map((handle) => ({\r\n            handle,\r\n            contractAddress: thisContractAddress,\r\n          }));\r\n\r\n          setMessage(\"Decrypting content...\");\r\n\r\n          // Decrypt all bytes at once (more efficient)\r\n          const decryptedResult = await instance.userDecrypt(\r\n            handleContractPairs,\r\n            sig.privateKey,\r\n            sig.publicKey,\r\n            sig.signature,\r\n            sig.contractAddresses,\r\n            sig.userAddress,\r\n            sig.startTimestamp,\r\n            sig.durationDays\r\n          );\r\n\r\n          if (await isStale()) {\r\n            setMessage(\"Ignore decryption\");\r\n            return;\r\n          }\r\n\r\n          // Extract decrypted values\r\n          for (let i = 0; i < encryptedBytes.length; i++) {\r\n            const handle = encryptedBytes[i];\r\n            const decryptedValue = decryptedResult[handle];\r\n            if (decryptedValue !== undefined) {\r\n              decryptedBytes.push(Number(decryptedValue));\r\n            } else {\r\n              // Fallback: decrypt individually if batch fails\r\n              console.warn(`Failed to decrypt byte ${i}, trying individually...`);\r\n              const individualResult = await instance.userDecrypt(\r\n                [{ handle, contractAddress: thisContractAddress }],\r\n                sig.privateKey,\r\n                sig.publicKey,\r\n                sig.signature,\r\n                sig.contractAddresses,\r\n                sig.userAddress,\r\n                sig.startTimestamp,\r\n                sig.durationDays\r\n              );\r\n              decryptedBytes.push(Number(individualResult[handle] || 0));\r\n            }\r\n          }\r\n\r\n          if (await isStale()) {\r\n            setMessage(\"Ignore decryption\");\r\n            return;\r\n          }\r\n\r\n          // Convert bytes to string\r\n          const decryptedContent = ethers.toUtf8String(new Uint8Array(decryptedBytes));\r\n\r\n          // Update dream with decrypted content\r\n          setDreams((prev) =>\r\n            prev.map((d) =>\r\n              d.id === dreamId\r\n                ? { ...d, decryptedContent, isDecrypting: false }\r\n                : { ...d, isDecrypting: false }\r\n            )\r\n          );\r\n\r\n          setMessage(\"Decryption completed!\");\r\n        } catch (e: any) {\r\n          const errorMsg = e?.message || \"Failed to decrypt dream\";\r\n          setMessage(`Decryption failed: ${errorMsg}`);\r\n          setDreams((prev) =>\r\n            prev.map((d) => (d.id === dreamId ? { ...d, isDecrypting: false } : d))\r\n          );\r\n        } finally {\r\n          isLoadingRef.current = false;\r\n          setIsLoading(false);\r\n        }\r\n      };\r\n\r\n      run();\r\n    },\r\n    [\r\n      dreamJournal.address,\r\n      dreams,\r\n      instance,\r\n      chainId,\r\n      ethersSigner,\r\n      ethersReadonlyProvider,\r\n      fhevmDecryptionSignatureStorage,\r\n      sameChain,\r\n      sameSigner,\r\n    ]\r\n  );\r\n\r\n  return {\r\n    contractAddress: dreamJournal.address,\r\n    dreams,\r\n    isLoading,\r\n    isCreating,\r\n    message,\r\n    canCreate,\r\n    canLoadDreams,\r\n    isDeployed,\r\n    createDream,\r\n    loadDreams,\r\n    decryptDream,\r\n  };\r\n};\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2027, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/components/ErrorNotDeployed.tsx"],"sourcesContent":["export function errorNotDeployed(chainId: number | undefined) {\r\n  return (\r\n    <div className=\"grid w-full gap-4 mx-auto font-semibold bg-none\">\r\n      <div className=\"col-span-full mx-20\">\r\n        <p className=\"text-4xl leading-relaxed\">\r\n          {\" \"}\r\n          <span className=\"font-mono bg-red-500\">Error</span>:{\" \"}\r\n          <span className=\"font-mono bg-white\">DreamJournal.sol</span> Contract\r\n          Not Deployed on{\" \"}\r\n          <span className=\"font-mono bg-white\">chainId={chainId}</span>{\" \"}\r\n          {chainId === 11155111 ? \"(Sepolia)\" : \"\"} or Deployment Address\r\n          Missing.\r\n        </p>\r\n        <p className=\"text-xl leading-relaxed mt-8\">\r\n          It appears that the{\" \"}\r\n          <span className=\"font-mono bg-white\">DreamJournal.sol</span> contract\r\n          has either not been deployed yet, or the deployment address is missing\r\n          from the ABI directory{\" \"}\r\n          <span className=\"font-mono bg-white\">frontend/abi</span>. To\r\n          deploy <span className=\"font-mono bg-white\">DreamJournal.sol</span> on\r\n          Sepolia, run the following command:\r\n        </p>\r\n        <p className=\"font-mono text-2xl leading-relaxed bg-black text-white p-4 mt-12\">\r\n          <span className=\"opacity-50 italic text-red-500\">\r\n            #from pro16 directory\r\n          </span>\r\n          <br />\r\n          npx hardhat deploy --network{\" \"}\r\n          {chainId === 11155111 ? \"sepolia\" : \"your-network-name\"}\r\n        </p>\r\n        <p className=\"text-xl leading-relaxed mt-12\">\r\n          <strong>Recommended:</strong> Switch to the local{\" \"}\r\n          <span className=\"font-mono bg-white\">Hardhat Node</span> using the\r\n          Rainbow wallet browser extension.\r\n        </p>\r\n        <div className=\"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\r\n          <p className=\"font-semibold text-blue-800 mb-2\">To use local Hardhat network:</p>\r\n          <ol className=\"list-decimal list-inside space-y-2 text-blue-700\">\r\n            <li>Make sure Hardhat node is running: <code className=\"bg-blue-100 px-2 py-1 rounded\">npx hardhat node</code></li>\r\n            <li>In Rainbow wallet, add custom network:\r\n              <ul className=\"list-disc list-inside ml-4 mt-1\">\r\n                <li>Network Name: <code className=\"bg-blue-100 px-1 rounded\">Hardhat Local</code></li>\r\n                <li>RPC URL: <code className=\"bg-blue-100 px-1 rounded\">http://localhost:8545</code></li>\r\n                <li>Chain ID: <code className=\"bg-blue-100 px-1 rounded\">31337</code></li>\r\n                <li>Currency Symbol: <code className=\"bg-blue-100 px-1 rounded\">ETH</code></li>\r\n              </ul>\r\n            </li>\r\n            <li>Switch to Hardhat Local network in Rainbow wallet</li>\r\n            <li>Refresh this page</li>\r\n          </ol>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,iBAAiB,OAA2B;IAC1D,qBACE,yMAAC;QAAI,WAAU;kBACb,cAAA,yMAAC;YAAI,WAAU;;8BACb,yMAAC;oBAAE,WAAU;;wBACV;sCACD,yMAAC;4BAAK,WAAU;sCAAuB;;;;;;wBAAY;wBAAE;sCACrD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;wBAC5C;sCAChB,yMAAC;4BAAK,WAAU;;gCAAqB;gCAAS;;;;;;;wBAAgB;wBAC7D,YAAY,WAAW,cAAc;wBAAG;;;;;;;8BAG3C,yMAAC;oBAAE,WAAU;;wBAA+B;wBACtB;sCACpB,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;wBAErC;sCACvB,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;sCACjD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAuB;;;;;;;8BAGrE,yMAAC;oBAAE,WAAU;;sCACX,yMAAC;4BAAK,WAAU;sCAAiC;;;;;;sCAGjD,yMAAC;;;;;wBAAK;wBACuB;wBAC5B,YAAY,WAAW,YAAY;;;;;;;8BAEtC,yMAAC;oBAAE,WAAU;;sCACX,yMAAC;sCAAO;;;;;;wBAAqB;wBAAqB;sCAClD,yMAAC;4BAAK,WAAU;sCAAqB;;;;;;wBAAmB;;;;;;;8BAG1D,yMAAC;oBAAI,WAAU;;sCACb,yMAAC;4BAAE,WAAU;sCAAmC;;;;;;sCAChD,yMAAC;4BAAG,WAAU;;8CACZ,yMAAC;;wCAAG;sDAAmC,yMAAC;4CAAK,WAAU;sDAAgC;;;;;;;;;;;;8CACvF,yMAAC;;wCAAG;sDACF,yMAAC;4CAAG,WAAU;;8DACZ,yMAAC;;wDAAG;sEAAc,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DAC7D,yMAAC;;wDAAG;sEAAS,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DACxD,yMAAC;;wDAAG;sEAAU,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;8DACzD,yMAAC;;wDAAG;sEAAiB,yMAAC;4DAAK,WAAU;sEAA2B;;;;;;;;;;;;;;;;;;;;;;;;8CAGpE,yMAAC;8CAAG;;;;;;8CACJ,yMAAC;8CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMhB","debugId":null}},
    {"offset": {"line": 2336, "column": 0}, "map": {"version":3,"sources":["file:///D:/Cursor-Ku/demo16/pro16/frontend/components/DreamJournalDemo.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef, useCallback, useEffect, useMemo } from \"react\";\r\nimport { ConnectButton } from \"@rainbow-me/rainbowkit\";\r\nimport { useAccount, useChainId, useWalletClient } from \"wagmi\";\r\nimport { ethers } from \"ethers\";\r\nimport { useFhevm } from \"@/fhevm/useFhevm\";\r\nimport { useInMemoryStorage } from \"@/hooks/useInMemoryStorage\";\r\nimport { useEthersSigner, useEthersProvider } from \"@/hooks/useEthersSigner\";\r\nimport { useDreamJournal } from \"@/hooks/useDreamJournal\";\r\nimport { errorNotDeployed } from \"./ErrorNotDeployed\";\r\n\r\nexport const DreamJournalDemo = () => {\r\n  const { isConnected, address } = useAccount();\r\n  const chainId = useChainId();\r\n  const { data: walletClient } = useWalletClient();\r\n  \r\n  const [title, setTitle] = useState(\"\");\r\n  const [content, setContent] = useState(\"\");\r\n  const [showDecrypted, setShowDecrypted] = useState<Record<string, boolean>>({});\r\n  const [ethersSigner, setEthersSigner] = useState<ethers.JsonRpcSigner | undefined>(undefined);\r\n\r\n  const { storage: fhevmDecryptionSignatureStorage } = useInMemoryStorage();\r\n  \r\n  const ethersProvider = useEthersProvider({ chainId });\r\n  \r\n  // Get EIP1193 provider - for local Hardhat, use RPC URL string directly\r\n  // For other networks, use walletClient transport or window.ethereum\r\n  const eip1193Provider = useMemo(() => {\r\n    if (chainId === 31337) {\r\n      // For local Hardhat, use RPC URL string\r\n      return \"http://localhost:8545\";\r\n    }\r\n    \r\n    // For other networks, try to get from walletClient\r\n    if (walletClient?.transport) {\r\n      const transport = walletClient.transport as any;\r\n      // Try to extract EIP1193 provider from transport\r\n      if (transport.value && typeof transport.value.request === \"function\") {\r\n        return transport.value;\r\n      }\r\n      if (typeof transport.request === \"function\") {\r\n        return transport;\r\n      }\r\n    }\r\n    \r\n    // Fallback to window.ethereum\r\n    if (typeof window !== \"undefined\" && (window as any).ethereum) {\r\n      return (window as any).ethereum;\r\n    }\r\n    \r\n    return undefined;\r\n  }, [chainId, walletClient]);\r\n\r\n  // Convert walletClient to ethers signer\r\n  useEffect(() => {\r\n    if (walletClient) {\r\n      const { account, chain, transport } = walletClient;\r\n      const network = {\r\n        chainId: chain.id,\r\n        name: chain.name,\r\n        ensAddress: chain.contracts?.ensRegistry?.address,\r\n      };\r\n      \r\n      try {\r\n        // Create provider from transport\r\n        const provider = new ethers.BrowserProvider(transport as any, network);\r\n        provider.getSigner(account.address)\r\n          .then(setEthersSigner)\r\n          .catch((err) => {\r\n            console.error(\"Failed to get signer:\", err);\r\n            setEthersSigner(undefined);\r\n          });\r\n      } catch (err) {\r\n        console.error(\"Failed to create provider:\", err);\r\n        setEthersSigner(undefined);\r\n      }\r\n    } else {\r\n      setEthersSigner(undefined);\r\n    }\r\n  }, [walletClient]);\r\n\r\n  // FHEVM instance\r\n  const {\r\n    instance: fhevmInstance,\r\n    status: fhevmStatus,\r\n    error: fhevmError,\r\n  } = useFhevm({\r\n    provider: eip1193Provider,\r\n    chainId,\r\n    initialMockChains: { 31337: \"http://localhost:8545\" },\r\n    enabled: isConnected && !!eip1193Provider,\r\n  });\r\n\r\n  // Debug: Log provider info and FHEVM status (only when status changes significantly)\r\n  const lastDebugRef = useRef<string>(\"\");\r\n  useEffect(() => {\r\n    if (isConnected) {\r\n      const debugKey = `${chainId}-${fhevmStatus}-${!!eip1193Provider}-${!!ethersSigner}`;\r\n      // Only log when something significant changes\r\n      if (debugKey !== lastDebugRef.current) {\r\n        lastDebugRef.current = debugKey;\r\n        console.log(\"Provider Debug:\", {\r\n          chainId,\r\n          hasEip1193Provider: !!eip1193Provider,\r\n          providerType: typeof eip1193Provider,\r\n          hasWalletClient: !!walletClient,\r\n          hasEthersSigner: !!ethersSigner,\r\n          hasEthersProvider: !!ethersProvider,\r\n          fhevmStatus,\r\n          fhevmError: fhevmError ? {\r\n            name: fhevmError.name,\r\n            message: fhevmError.message,\r\n          } : null,\r\n        });\r\n      }\r\n    }\r\n  }, [isConnected, chainId, eip1193Provider, walletClient, ethersSigner, ethersProvider, fhevmStatus, fhevmError]);\r\n\r\n  // Same chain/signer refs\r\n  const sameChainRef = useRef((id: number | undefined) => id === chainId);\r\n  const currentSignerAddressRef = useRef<string | undefined>(undefined);\r\n  \r\n  // Update signer address ref when signer changes\r\n  useEffect(() => {\r\n    if (ethersSigner) {\r\n      ethersSigner.getAddress().then((addr) => {\r\n        currentSignerAddressRef.current = addr.toLowerCase();\r\n      }).catch(() => {\r\n        currentSignerAddressRef.current = undefined;\r\n      });\r\n    } else {\r\n      currentSignerAddressRef.current = undefined;\r\n    }\r\n  }, [ethersSigner]);\r\n  \r\n  const sameSignerRef = useRef(async (signer: ethers.JsonRpcSigner | undefined) => {\r\n    if (!signer) {\r\n      return !currentSignerAddressRef.current; // Both undefined\r\n    }\r\n    if (!currentSignerAddressRef.current) {\r\n      return false; // Current signer is undefined but provided signer is not\r\n    }\r\n    try {\r\n      const signerAddress = (await signer.getAddress()).toLowerCase();\r\n      return signerAddress === currentSignerAddressRef.current;\r\n    } catch {\r\n      return false;\r\n    }\r\n  });\r\n\r\n  // Dream journal hook\r\n  const {\r\n    contractAddress,\r\n    dreams,\r\n    isLoading,\r\n    isCreating,\r\n    message,\r\n    canCreate,\r\n    canLoadDreams,\r\n    isDeployed,\r\n    createDream,\r\n    loadDreams,\r\n    decryptDream,\r\n  } = useDreamJournal({\r\n    instance: fhevmInstance,\r\n    fhevmDecryptionSignatureStorage,\r\n    eip1193Provider,\r\n    chainId,\r\n    ethersSigner: ethersSigner || undefined,\r\n    ethersReadonlyProvider: ethersProvider || undefined,\r\n    sameChain: sameChainRef,\r\n    sameSigner: sameSignerRef,\r\n  });\r\n\r\n  const handleCreateDreamRef = useRef(false);\r\n  \r\n  const handleCreateDream = useCallback(() => {\r\n    // Prevent duplicate calls - use ref to track\r\n    if (handleCreateDreamRef.current) {\r\n      console.log(\"[handleCreateDream] Already processing (ref=true), ignoring duplicate call\");\r\n      return;\r\n    }\r\n    \r\n    if (isCreating) {\r\n      console.log(\"[handleCreateDream] isCreating=true, ignoring duplicate call\");\r\n      return;\r\n    }\r\n    \r\n    if (!title.trim() || !content.trim()) {\r\n      alert(\"Please enter both title and content\");\r\n      return;\r\n    }\r\n    \r\n    // Check if FHEVM instance is ready before creating\r\n    if (!fhevmInstance) {\r\n      alert(\"FHEVM instance is not ready. Please wait a moment and try again.\\n\\nIf this persists, check:\\n1. Wallet is connected\\n2. Network is Hardhat Local (Chain ID: 31337)\\n3. Hardhat node is running\");\r\n      return;\r\n    }\r\n    \r\n    handleCreateDreamRef.current = true;\r\n    console.log(\"[handleCreateDream] Creating dream with:\", { \r\n      title: title.trim(), \r\n      contentLength: content.trim().length, \r\n      hasInstance: !!fhevmInstance,\r\n      fhevmStatus,\r\n      hasSigner: !!ethersSigner,\r\n      contractAddress,\r\n      canCreate,\r\n      isCreating,\r\n    });\r\n    \r\n    // Call createDream\r\n    createDream(title.trim(), content.trim());\r\n    \r\n    // Reset the ref after a delay to allow retry if needed\r\n    setTimeout(() => {\r\n      handleCreateDreamRef.current = false;\r\n    }, 5000);\r\n  }, [title, content, createDream, fhevmInstance, fhevmStatus, ethersSigner, contractAddress, canCreate, isCreating]);\r\n  \r\n  // Clear form when dream is created successfully\r\n  useEffect(() => {\r\n    if (message && message.includes(\"Dream created successfully\")) {\r\n      setTitle(\"\");\r\n      setContent(\"\");\r\n    }\r\n  }, [message]);\r\n\r\n  const handleDecryptDream = useCallback(\r\n    (dreamId: bigint) => {\r\n      const dream = dreams.find((d) => d.id === dreamId);\r\n      if (dream?.decryptedContent) {\r\n        // Toggle display\r\n        setShowDecrypted((prev) => ({\r\n          ...prev,\r\n          [dreamId.toString()]: !prev[dreamId.toString()],\r\n        }));\r\n      } else {\r\n        // Decrypt\r\n        decryptDream(dreamId);\r\n        setShowDecrypted((prev) => ({\r\n          ...prev,\r\n          [dreamId.toString()]: true,\r\n        }));\r\n      }\r\n    },\r\n    [dreams, decryptDream]\r\n  );\r\n\r\n  if (!isConnected) {\r\n    return (\r\n      <div className=\"mx-auto w-full max-w-2xl\">\r\n        <div className=\"bg-white rounded-lg shadow-lg p-8 text-center\">\r\n          <h2 className=\"text-3xl font-bold mb-4 text-gray-800\">\r\n            Welcome to Dream Journal\r\n          </h2>\r\n          <p className=\"text-gray-600 mb-8\">\r\n            Connect your Rainbow wallet to start recording your encrypted dreams.\r\n            Your dreams are encrypted on-chain and only you can decrypt them.\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <ConnectButton />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Display FHEVM error if present\r\n  if (fhevmError && fhevmStatus === \"error\") {\r\n    return (\r\n      <div className=\"mx-auto w-full max-w-2xl\">\r\n        <div className=\"bg-red-50 border-2 border-red-400 rounded-lg p-8\">\r\n          <h2 className=\"text-2xl font-bold mb-4 text-red-800\">\r\n            FHEVM Initialization Error\r\n          </h2>\r\n          <p className=\"text-red-700 mb-4\">\r\n            <strong>Error:</strong> {fhevmError.message}\r\n          </p>\r\n          <div className=\"bg-white p-4 rounded-lg border border-red-300\">\r\n            <p className=\"font-semibold text-gray-800 mb-2\">Troubleshooting Steps:</p>\r\n            <ol className=\"list-decimal list-inside space-y-2 text-sm text-gray-700\">\r\n              <li>Ensure Hardhat node is running:\r\n                <code className=\"bg-gray-100 px-2 py-1 rounded ml-2\">npx hardhat node</code>\r\n              </li>\r\n              <li>Verify RPC endpoint is accessible:\r\n                <code className=\"bg-gray-100 px-2 py-1 rounded ml-2\">http://localhost:8545</code>\r\n              </li>\r\n              <li>Check that you're connected to Hardhat Local network (Chain ID: 31337)</li>\r\n              <li>Try refreshing the page</li>\r\n              <li>Check browser console for more details</li>\r\n            </ol>\r\n          </div>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n          >\r\n            Reload Page\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Check if on supported network (Hardhat Local or Sepolia)\r\n  const isCorrectNetwork = chainId === 31337 || chainId === 11155111; // Hardhat local or Sepolia\r\n  \r\n  if (!isCorrectNetwork && chainId !== undefined) {\r\n    return (\r\n      <div className=\"mx-auto w-full max-w-2xl\">\r\n        <div className=\"bg-yellow-50 border-2 border-yellow-400 rounded-lg p-8\">\r\n          <h2 className=\"text-2xl font-bold mb-4 text-yellow-800\">\r\n            Wrong Network Detected\r\n          </h2>\r\n          <p className=\"text-yellow-700 mb-4\">\r\n            You are connected to network with Chain ID: <strong>{chainId}</strong>\r\n          </p>\r\n          <p className=\"text-yellow-700 mb-6\">\r\n            Please switch to <strong>Hardhat Local</strong> (Chain ID: 31337) or <strong>Sepolia</strong> (Chain ID: 11155111) to use this application.\r\n          </p>\r\n          <div className=\"bg-white p-4 rounded-lg border border-yellow-300\">\r\n            <p className=\"font-semibold text-gray-800 mb-2\">Supported Networks:</p>\r\n            <ul className=\"list-disc list-inside space-y-2 text-sm text-gray-700 mb-4\">\r\n              <li><strong>Sepolia Testnet</strong> (Chain ID: 11155111) - Already configured in Rainbow wallet</li>\r\n              <li><strong>Hardhat Local</strong> (Chain ID: 31337) - For local development</li>\r\n            </ul>\r\n            <p className=\"font-semibold text-gray-800 mb-2\">To add Hardhat Local network in Rainbow (for local development):</p>\r\n            <ol className=\"list-decimal list-inside space-y-1 text-sm text-gray-700\">\r\n              <li>Click on network selector in Rainbow wallet</li>\r\n              <li>Click \"Add Network\" or \"Custom Network\"</li>\r\n              <li>Enter these details:\r\n                <ul className=\"list-disc list-inside ml-4 mt-1 space-y-1\">\r\n                  <li>Network Name: <code className=\"bg-gray-100 px-1 rounded\">Hardhat Local</code></li>\r\n                  <li>RPC URL: <code className=\"bg-gray-100 px-1 rounded\">http://localhost:8545</code></li>\r\n                  <li>Chain ID: <code className=\"bg-gray-100 px-1 rounded\">31337</code></li>\r\n                  <li>Currency Symbol: <code className=\"bg-gray-100 px-1 rounded\">ETH</code></li>\r\n                </ul>\r\n              </li>\r\n              <li>Make sure Hardhat node is running: <code className=\"bg-gray-100 px-1 rounded\">npx hardhat node</code></li>\r\n            </ol>\r\n          </div>\r\n          <div className=\"mt-6\">\r\n            <ConnectButton />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isDeployed === false) {\r\n    return errorNotDeployed(chainId);\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full max-w-5xl mx-auto space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h2 className=\"text-2xl font-bold text-gray-800\">My Dreams</h2>\r\n          <ConnectButton />\r\n        </div>\r\n        <div className=\"flex flex-wrap gap-2 text-sm text-gray-600\">\r\n          <span>Connected: {address}</span>\r\n          {contractAddress && (\r\n            <>\r\n              <span></span>\r\n              <span>Contract: {contractAddress.slice(0, 6)}...{contractAddress.slice(-4)}</span>\r\n            </>\r\n          )}\r\n          {message && (\r\n            <>\r\n              <span></span>\r\n              <span className=\"text-blue-600\">{message}</span>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Create Dream Form */}\r\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n        <h3 className=\"text-xl font-semibold mb-4 text-gray-800\">\r\n          Create New Dream\r\n        </h3>\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Title\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n              placeholder=\"e.g., Flying Dream\"\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\r\n              disabled={isCreating}\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Dream Content\r\n            </label>\r\n            <textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder=\"Describe your dream... (will be encrypted before storage)\"\r\n              rows={5}\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none\"\r\n              disabled={isCreating}\r\n            />\r\n            <p className=\"mt-1 text-xs text-gray-500\">\r\n              Your dream content will be encrypted locally before being stored on-chain.\r\n            </p>\r\n          </div>\r\n          <button\r\n            onClick={handleCreateDream}\r\n            disabled={!canCreate || !title.trim() || !content.trim()}\r\n            className=\"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold rounded-lg shadow-md hover:from-purple-700 hover:to-indigo-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {isCreating ? \"Encrypting...\" : \"Encrypt & Create Dream\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Dreams List */}\r\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h3 className=\"text-xl font-semibold text-gray-800\">\r\n            My Dream Entries ({dreams.length})\r\n          </h3>\r\n          <button\r\n            onClick={loadDreams}\r\n            disabled={!canLoadDreams || isLoading}\r\n            className=\"px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            {isLoading ? \"Loading...\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n\r\n        {dreams.length === 0 ? (\r\n          <div className=\"text-center py-12 text-gray-500\">\r\n            <p className=\"text-lg mb-2\">No dreams yet</p>\r\n            <p className=\"text-sm\">Create your first encrypted dream entry above!</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {dreams.map((dream) => (\r\n              <div\r\n                key={dream.id.toString()}\r\n                className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n              >\r\n                <div className=\"flex justify-between items-start mb-2\">\r\n                  <div className=\"flex-1\">\r\n                    <h4 className=\"font-semibold text-lg text-gray-800 mb-1\">\r\n                      {dream.title}\r\n                    </h4>\r\n                    <p className=\"text-sm text-gray-500\">\r\n                      Created: {new Date(Number(dream.createdAt) * 1000).toLocaleString()}\r\n                    </p>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => handleDecryptDream(dream.id)}\r\n                    disabled={dream.isDecrypting || isLoading}\r\n                    className=\"ml-4 px-4 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    {dream.isDecrypting\r\n                      ? \"Decrypting...\"\r\n                      : dream.decryptedContent && showDecrypted[dream.id.toString()]\r\n                      ? \"Hide\"\r\n                      : \"Decrypt & View\"}\r\n                  </button>\r\n                </div>\r\n                \r\n                {dream.decryptedContent && showDecrypted[dream.id.toString()] && (\r\n                  <div className=\"mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200\">\r\n                    <p className=\"text-sm font-medium text-purple-800 mb-2\">\r\n                      Decrypted Content:\r\n                    </p>\r\n                    <p className=\"text-gray-700 whitespace-pre-wrap\">\r\n                      {dream.decryptedContent}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* FHEVM Status (Debug) */}\r\n      {process.env.NODE_ENV === \"development\" && (\r\n        <div className=\"bg-gray-100 rounded-lg p-4 text-xs text-gray-600\">\r\n          <p>FHEVM Status: {fhevmStatus}</p>\r\n          {fhevmError && <p>Error: {fhevmError.message}</p>}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}}]
}